{"ast":null,"code":"import { Subject, takeUntil } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../services/canvas.service\";\nimport * as i2 from \"../../services/tool.service\";\nimport * as i3 from \"../../services/history.service\";\nconst _c0 = [\"canvas\"];\nexport class CanvasComponent {\n  constructor(canvasService, toolService, historyService) {\n    this.canvasService = canvasService;\n    this.toolService = toolService;\n    this.historyService = historyService;\n    this.isDrawing = false;\n    this.startPoint = {\n      x: 0,\n      y: 0\n    };\n    this.currentElement = null;\n    this.destroy$ = new Subject();\n    this.isPanning = false;\n    this.lastPanPoint = {\n      x: 0,\n      y: 0\n    };\n  }\n  ngAfterViewInit() {\n    this.initCanvas();\n    this.setupSubscriptions();\n    this.render();\n  }\n  ngOnDestroy() {\n    this.destroy$.next();\n    this.destroy$.complete();\n  }\n  initCanvas() {\n    const canvas = this.canvasRef.nativeElement;\n    this.ctx = canvas.getContext('2d');\n    this.resizeCanvas();\n  }\n  setupSubscriptions() {\n    this.canvasService.elements$.pipe(takeUntil(this.destroy$)).subscribe(() => this.render());\n    this.canvasService.zoom$.pipe(takeUntil(this.destroy$)).subscribe(() => this.render());\n    this.canvasService.pan$.pipe(takeUntil(this.destroy$)).subscribe(() => this.render());\n  }\n  resizeCanvas() {\n    const canvas = this.canvasRef.nativeElement;\n    canvas.width = canvas.offsetWidth;\n    canvas.height = canvas.offsetHeight;\n    this.render();\n  }\n  handleKeyDown(event) {\n    if (event.ctrlKey && event.key === 'z') {\n      event.preventDefault();\n      const state = this.historyService.undo();\n      if (state) this.canvasService.setState(state);\n    } else if (event.ctrlKey && event.key === 'y') {\n      event.preventDefault();\n      const state = this.historyService.redo();\n      if (state) this.canvasService.setState(state);\n    } else if (event.key === 'Delete') {\n      event.preventDefault();\n      this.canvasService.deleteSelectedElements();\n      this.historyService.addState(this.canvasService.getState());\n    }\n  }\n  onMouseDown(event) {\n    const point = this.getCanvasPoint(event);\n    const tool = this.toolService.currentTool;\n    if (tool === 'pan') {\n      this.isPanning = true;\n      this.lastPanPoint = {\n        x: event.clientX,\n        y: event.clientY\n      };\n      return;\n    }\n    if (tool === 'select') {\n      this.handleSelection(point, event.shiftKey);\n      return;\n    }\n    this.isDrawing = true;\n    this.startPoint = point;\n    this.canvasService.clearSelection();\n    this.currentElement = {\n      id: this.canvasService.generateId(),\n      type: tool,\n      x: point.x,\n      y: point.y,\n      strokeColor: this.toolService.strokeColor,\n      fillColor: this.toolService.fillColor,\n      strokeWidth: this.toolService.strokeWidth,\n      rotation: 0,\n      points: tool === 'freedraw' ? [point] : []\n    };\n    if (tool === 'text') {\n      this.handleTextInput(point);\n    }\n  }\n  onMouseMove(event) {\n    if (this.isPanning) {\n      const dx = event.clientX - this.lastPanPoint.x;\n      const dy = event.clientY - this.lastPanPoint.y;\n      const pan = this.canvasService.pan;\n      this.canvasService.setPan({\n        x: pan.x + dx,\n        y: pan.y + dy\n      });\n      this.lastPanPoint = {\n        x: event.clientX,\n        y: event.clientY\n      };\n      return;\n    }\n    if (!this.isDrawing || !this.currentElement) return;\n    const point = this.getCanvasPoint(event);\n    const tool = this.toolService.currentTool;\n    if (tool === 'freedraw') {\n      this.currentElement.points.push(point);\n    } else {\n      this.currentElement.width = point.x - this.startPoint.x;\n      this.currentElement.height = point.y - this.startPoint.y;\n    }\n    this.render();\n    if (this.currentElement) {\n      this.drawElement(this.currentElement);\n    }\n  }\n  onMouseUp(event) {\n    if (this.isPanning) {\n      this.isPanning = false;\n      return;\n    }\n    if (!this.isDrawing || !this.currentElement) return;\n    if (this.toolService.currentTool !== 'text') {\n      this.canvasService.addElement(this.currentElement);\n      this.historyService.addState(this.canvasService.getState());\n    }\n    this.isDrawing = false;\n    this.currentElement = null;\n  }\n  onWheel(event) {\n    if (event.ctrlKey) {\n      event.preventDefault();\n      const delta = event.deltaY > 0 ? 0.9 : 1.1;\n      this.canvasService.setZoom(this.canvasService.zoom * delta);\n    }\n  }\n  getCanvasPoint(event) {\n    const canvas = this.canvasRef.nativeElement;\n    const rect = canvas.getBoundingClientRect();\n    const zoom = this.canvasService.zoom;\n    const pan = this.canvasService.pan;\n    return {\n      x: (event.clientX - rect.left - pan.x) / zoom,\n      y: (event.clientY - rect.top - pan.y) / zoom\n    };\n  }\n  handleSelection(point, addToSelection) {\n    const elements = this.canvasService.elements;\n    for (let i = elements.length - 1; i >= 0; i--) {\n      const el = elements[i];\n      if (this.isPointInElement(point, el)) {\n        this.canvasService.selectElement(el.id, addToSelection);\n        return;\n      }\n    }\n    if (!addToSelection) {\n      this.canvasService.clearSelection();\n    }\n  }\n  isPointInElement(point, element) {\n    if (element.type === 'freedraw') {\n      return element.points?.some(p => Math.abs(p.x - point.x) < 10 && Math.abs(p.y - point.y) < 10) || false;\n    }\n    const x = element.x;\n    const y = element.y;\n    const w = element.width || 0;\n    const h = element.height || 0;\n    return point.x >= Math.min(x, x + w) && point.x <= Math.max(x, x + w) && point.y >= Math.min(y, y + h) && point.y <= Math.max(y, y + h);\n  }\n  handleTextInput(point) {\n    const text = prompt('Digite o texto:');\n    if (text && this.currentElement) {\n      this.currentElement.text = text;\n      this.currentElement.width = text.length * 10;\n      this.currentElement.height = 20;\n      this.canvasService.addElement(this.currentElement);\n      this.historyService.addState(this.canvasService.getState());\n    }\n    this.isDrawing = false;\n    this.currentElement = null;\n  }\n  render() {\n    const canvas = this.canvasRef.nativeElement;\n    this.ctx.clearRect(0, 0, canvas.width, canvas.height);\n    this.ctx.save();\n    const zoom = this.canvasService.zoom;\n    const pan = this.canvasService.pan;\n    this.ctx.translate(pan.x, pan.y);\n    this.ctx.scale(zoom, zoom);\n    this.canvasService.elements.forEach(element => {\n      this.drawElement(element);\n    });\n    this.ctx.restore();\n  }\n  drawElement(element) {\n    this.ctx.save();\n    this.ctx.strokeStyle = element.strokeColor;\n    this.ctx.fillStyle = element.fillColor;\n    this.ctx.lineWidth = element.strokeWidth;\n    if (element.isSelected) {\n      this.ctx.strokeStyle = '#4CAF50';\n      this.ctx.lineWidth = element.strokeWidth + 2;\n    }\n    switch (element.type) {\n      case 'rectangle':\n        this.drawRectangle(element);\n        break;\n      case 'circle':\n        this.drawCircle(element);\n        break;\n      case 'ellipse':\n        this.drawEllipse(element);\n        break;\n      case 'line':\n        this.drawLine(element);\n        break;\n      case 'arrow':\n        this.drawArrow(element);\n        break;\n      case 'freedraw':\n        this.drawFreeDraw(element);\n        break;\n      case 'text':\n        this.drawText(element);\n        break;\n    }\n    this.ctx.restore();\n  }\n  drawRectangle(element) {\n    const w = element.width || 0;\n    const h = element.height || 0;\n    this.ctx.fillRect(element.x, element.y, w, h);\n    this.ctx.strokeRect(element.x, element.y, w, h);\n  }\n  drawCircle(element) {\n    const radius = Math.abs(element.width || 0) / 2;\n    const centerX = element.x + (element.width || 0) / 2;\n    const centerY = element.y + (element.height || 0) / 2;\n    this.ctx.beginPath();\n    this.ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);\n    this.ctx.fill();\n    this.ctx.stroke();\n  }\n  drawEllipse(element) {\n    const radiusX = Math.abs(element.width || 0) / 2;\n    const radiusY = Math.abs(element.height || 0) / 2;\n    const centerX = element.x + (element.width || 0) / 2;\n    const centerY = element.y + (element.height || 0) / 2;\n    this.ctx.beginPath();\n    this.ctx.ellipse(centerX, centerY, radiusX, radiusY, 0, 0, Math.PI * 2);\n    this.ctx.fill();\n    this.ctx.stroke();\n  }\n  drawLine(element) {\n    const endX = element.x + (element.width || 0);\n    const endY = element.y + (element.height || 0);\n    this.ctx.beginPath();\n    this.ctx.moveTo(element.x, element.y);\n    this.ctx.lineTo(endX, endY);\n    this.ctx.stroke();\n  }\n  drawArrow(element) {\n    const endX = element.x + (element.width || 0);\n    const endY = element.y + (element.height || 0);\n    // Draw line\n    this.ctx.beginPath();\n    this.ctx.moveTo(element.x, element.y);\n    this.ctx.lineTo(endX, endY);\n    this.ctx.stroke();\n    // Draw arrowhead\n    const angle = Math.atan2(endY - element.y, endX - element.x);\n    const headLength = 15;\n    this.ctx.beginPath();\n    this.ctx.moveTo(endX, endY);\n    this.ctx.lineTo(endX - headLength * Math.cos(angle - Math.PI / 6), endY - headLength * Math.sin(angle - Math.PI / 6));\n    this.ctx.moveTo(endX, endY);\n    this.ctx.lineTo(endX - headLength * Math.cos(angle + Math.PI / 6), endY - headLength * Math.sin(angle + Math.PI / 6));\n    this.ctx.stroke();\n  }\n  drawFreeDraw(element) {\n    if (!element.points || element.points.length < 2) return;\n    this.ctx.beginPath();\n    this.ctx.moveTo(element.points[0].x, element.points[0].y);\n    for (let i = 1; i < element.points.length; i++) {\n      this.ctx.lineTo(element.points[i].x, element.points[i].y);\n    }\n    this.ctx.stroke();\n  }\n  drawText(element) {\n    if (!element.text) return;\n    this.ctx.font = '16px Arial';\n    this.ctx.fillStyle = element.strokeColor;\n    this.ctx.fillText(element.text, element.x, element.y + 16);\n    if (element.isSelected) {\n      this.ctx.strokeRect(element.x - 2, element.y, element.width || 0, element.height || 0);\n    }\n  }\n  static {\n    this.ɵfac = function CanvasComponent_Factory(t) {\n      return new (t || CanvasComponent)(i0.ɵɵdirectiveInject(i1.CanvasService), i0.ɵɵdirectiveInject(i2.ToolService), i0.ɵɵdirectiveInject(i3.HistoryService));\n    };\n  }\n  static {\n    this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: CanvasComponent,\n      selectors: [[\"app-canvas\"]],\n      viewQuery: function CanvasComponent_Query(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵviewQuery(_c0, 5);\n        }\n        if (rf & 2) {\n          let _t;\n          i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.canvasRef = _t.first);\n        }\n      },\n      hostBindings: function CanvasComponent_HostBindings(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵlistener(\"resize\", function CanvasComponent_resize_HostBindingHandler() {\n            return ctx.resizeCanvas();\n          }, false, i0.ɵɵresolveWindow)(\"keydown\", function CanvasComponent_keydown_HostBindingHandler($event) {\n            return ctx.handleKeyDown($event);\n          }, false, i0.ɵɵresolveWindow)(\"wheel\", function CanvasComponent_wheel_HostBindingHandler($event) {\n            return ctx.onWheel($event);\n          });\n        }\n      },\n      decls: 3,\n      vars: 0,\n      consts: [[\"canvas\", \"\"], [1, \"canvas-container\"], [3, \"mousedown\", \"mousemove\", \"mouseup\"]],\n      template: function CanvasComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          const _r1 = i0.ɵɵgetCurrentView();\n          i0.ɵɵelementStart(0, \"div\", 1)(1, \"canvas\", 2, 0);\n          i0.ɵɵlistener(\"mousedown\", function CanvasComponent_Template_canvas_mousedown_1_listener($event) {\n            i0.ɵɵrestoreView(_r1);\n            return i0.ɵɵresetView(ctx.onMouseDown($event));\n          })(\"mousemove\", function CanvasComponent_Template_canvas_mousemove_1_listener($event) {\n            i0.ɵɵrestoreView(_r1);\n            return i0.ɵɵresetView(ctx.onMouseMove($event));\n          })(\"mouseup\", function CanvasComponent_Template_canvas_mouseup_1_listener($event) {\n            i0.ɵɵrestoreView(_r1);\n            return i0.ɵɵresetView(ctx.onMouseUp($event));\n          });\n          i0.ɵɵelementEnd()();\n        }\n      },\n      styles: [\".canvas-container[_ngcontent-%COMP%] {\\n  flex: 1;\\n  position: relative;\\n  overflow: hidden;\\n  background: #fafafa;\\n  background-image: linear-gradient(#e0e0e0 1px, transparent 1px), linear-gradient(90deg, #e0e0e0 1px, transparent 1px);\\n  background-size: 20px 20px;\\n}\\n\\ncanvas[_ngcontent-%COMP%] {\\n  width: 100%;\\n  height: 100%;\\n  display: block;\\n  cursor: crosshair;\\n}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL3NyYy9hcHAvY29tcG9uZW50cy9jYW52YXMvY2FudmFzLmNvbXBvbmVudC5zY3NzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0VBQ0UsT0FBQTtFQUNBLGtCQUFBO0VBQ0EsZ0JBQUE7RUFDQSxtQkFBQTtFQUNBLHFIQUNFO0VBRUYsMEJBQUE7QUFERjs7QUFJQTtFQUNFLFdBQUE7RUFDQSxZQUFBO0VBQ0EsY0FBQTtFQUNBLGlCQUFBO0FBREYiLCJzb3VyY2VzQ29udGVudCI6WyIuY2FudmFzLWNvbnRhaW5lciB7XHJcbiAgZmxleDogMTtcclxuICBwb3NpdGlvbjogcmVsYXRpdmU7XHJcbiAgb3ZlcmZsb3c6IGhpZGRlbjtcclxuICBiYWNrZ3JvdW5kOiAjZmFmYWZhO1xyXG4gIGJhY2tncm91bmQtaW1hZ2U6IFxyXG4gICAgbGluZWFyLWdyYWRpZW50KCNlMGUwZTAgMXB4LCB0cmFuc3BhcmVudCAxcHgpLFxyXG4gICAgbGluZWFyLWdyYWRpZW50KDkwZGVnLCAjZTBlMGUwIDFweCwgdHJhbnNwYXJlbnQgMXB4KTtcclxuICBiYWNrZ3JvdW5kLXNpemU6IDIwcHggMjBweDtcclxufVxyXG5cclxuY2FudmFzIHtcclxuICB3aWR0aDogMTAwJTtcclxuICBoZWlnaHQ6IDEwMCU7XHJcbiAgZGlzcGxheTogYmxvY2s7XHJcbiAgY3Vyc29yOiBjcm9zc2hhaXI7XHJcbn1cclxuIl0sInNvdXJjZVJvb3QiOiIifQ== */\"]\n    });\n  }\n}","map":{"version":3,"names":["Subject","takeUntil","CanvasComponent","constructor","canvasService","toolService","historyService","isDrawing","startPoint","x","y","currentElement","destroy$","isPanning","lastPanPoint","ngAfterViewInit","initCanvas","setupSubscriptions","render","ngOnDestroy","next","complete","canvas","canvasRef","nativeElement","ctx","getContext","resizeCanvas","elements$","pipe","subscribe","zoom$","pan$","width","offsetWidth","height","offsetHeight","handleKeyDown","event","ctrlKey","key","preventDefault","state","undo","setState","redo","deleteSelectedElements","addState","getState","onMouseDown","point","getCanvasPoint","tool","currentTool","clientX","clientY","handleSelection","shiftKey","clearSelection","id","generateId","type","strokeColor","fillColor","strokeWidth","rotation","points","handleTextInput","onMouseMove","dx","dy","pan","setPan","push","drawElement","onMouseUp","addElement","onWheel","delta","deltaY","setZoom","zoom","rect","getBoundingClientRect","left","top","addToSelection","elements","i","length","el","isPointInElement","selectElement","element","some","p","Math","abs","w","h","min","max","text","prompt","clearRect","save","translate","scale","forEach","restore","strokeStyle","fillStyle","lineWidth","isSelected","drawRectangle","drawCircle","drawEllipse","drawLine","drawArrow","drawFreeDraw","drawText","fillRect","strokeRect","radius","centerX","centerY","beginPath","arc","PI","fill","stroke","radiusX","radiusY","ellipse","endX","endY","moveTo","lineTo","angle","atan2","headLength","cos","sin","font","fillText","i0","ɵɵdirectiveInject","i1","CanvasService","i2","ToolService","i3","HistoryService","selectors","viewQuery","CanvasComponent_Query","rf","ɵɵlistener","CanvasComponent_resize_HostBindingHandler","ɵɵresolveWindow","CanvasComponent_keydown_HostBindingHandler","$event","CanvasComponent_wheel_HostBindingHandler","ɵɵelementStart","CanvasComponent_Template_canvas_mousedown_1_listener","ɵɵrestoreView","_r1","ɵɵresetView","CanvasComponent_Template_canvas_mousemove_1_listener","CanvasComponent_Template_canvas_mouseup_1_listener","ɵɵelementEnd"],"sources":["C:\\Users\\vinic\\Desktop\\Estagio\\Teste\\src\\app\\components\\canvas\\canvas.component.ts","C:\\Users\\vinic\\Desktop\\Estagio\\Teste\\src\\app\\components\\canvas\\canvas.component.html"],"sourcesContent":["import { Component, ElementRef, ViewChild, AfterViewInit, HostListener, OnDestroy } from '@angular/core';\r\nimport { Subject, takeUntil } from 'rxjs';\r\nimport { CanvasService } from '../../services/canvas.service';\r\nimport { ToolService } from '../../services/tool.service';\r\nimport { HistoryService } from '../../services/history.service';\r\nimport { DrawingElement, Point, ToolType } from '../../models/drawing.model';\r\n\r\n@Component({\r\n  selector: 'app-canvas',\r\n  templateUrl: './canvas.component.html',\r\n  styleUrls: ['./canvas.component.scss']\r\n})\r\nexport class CanvasComponent implements AfterViewInit, OnDestroy {\r\n  @ViewChild('canvas', { static: false }) canvasRef!: ElementRef<HTMLCanvasElement>;\r\n  \r\n  private ctx!: CanvasRenderingContext2D;\r\n  private isDrawing = false;\r\n  private startPoint: Point = { x: 0, y: 0 };\r\n  private currentElement: DrawingElement | null = null;\r\n  private destroy$ = new Subject<void>();\r\n  private isPanning = false;\r\n  private lastPanPoint: Point = { x: 0, y: 0 };\r\n\r\n  constructor(\r\n    public canvasService: CanvasService,\r\n    private toolService: ToolService,\r\n    private historyService: HistoryService\r\n  ) {}\r\n\r\n  ngAfterViewInit(): void {\r\n    this.initCanvas();\r\n    this.setupSubscriptions();\r\n    this.render();\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.destroy$.next();\r\n    this.destroy$.complete();\r\n  }\r\n\r\n  private initCanvas(): void {\r\n    const canvas = this.canvasRef.nativeElement;\r\n    this.ctx = canvas.getContext('2d')!;\r\n    this.resizeCanvas();\r\n  }\r\n\r\n  private setupSubscriptions(): void {\r\n    this.canvasService.elements$\r\n      .pipe(takeUntil(this.destroy$))\r\n      .subscribe(() => this.render());\r\n\r\n    this.canvasService.zoom$\r\n      .pipe(takeUntil(this.destroy$))\r\n      .subscribe(() => this.render());\r\n\r\n    this.canvasService.pan$\r\n      .pipe(takeUntil(this.destroy$))\r\n      .subscribe(() => this.render());\r\n  }\r\n\r\n  @HostListener('window:resize')\r\n  private resizeCanvas(): void {\r\n    const canvas = this.canvasRef.nativeElement;\r\n    canvas.width = canvas.offsetWidth;\r\n    canvas.height = canvas.offsetHeight;\r\n    this.render();\r\n  }\r\n\r\n  @HostListener('window:keydown', ['$event'])\r\n  handleKeyDown(event: KeyboardEvent): void {\r\n    if (event.ctrlKey && event.key === 'z') {\r\n      event.preventDefault();\r\n      const state = this.historyService.undo();\r\n      if (state) this.canvasService.setState(state);\r\n    } else if (event.ctrlKey && event.key === 'y') {\r\n      event.preventDefault();\r\n      const state = this.historyService.redo();\r\n      if (state) this.canvasService.setState(state);\r\n    } else if (event.key === 'Delete') {\r\n      event.preventDefault();\r\n      this.canvasService.deleteSelectedElements();\r\n      this.historyService.addState(this.canvasService.getState());\r\n    }\r\n  }\r\n\r\n  onMouseDown(event: MouseEvent): void {\r\n    const point = this.getCanvasPoint(event);\r\n    const tool = this.toolService.currentTool;\r\n\r\n    if (tool === 'pan') {\r\n      this.isPanning = true;\r\n      this.lastPanPoint = { x: event.clientX, y: event.clientY };\r\n      return;\r\n    }\r\n\r\n    if (tool === 'select') {\r\n      this.handleSelection(point, event.shiftKey);\r\n      return;\r\n    }\r\n\r\n    this.isDrawing = true;\r\n    this.startPoint = point;\r\n    this.canvasService.clearSelection();\r\n\r\n    this.currentElement = {\r\n      id: this.canvasService.generateId(),\r\n      type: tool as Exclude<ToolType, 'select' | 'pan'>,\r\n      x: point.x,\r\n      y: point.y,\r\n      strokeColor: this.toolService.strokeColor,\r\n      fillColor: this.toolService.fillColor,\r\n      strokeWidth: this.toolService.strokeWidth,\r\n      rotation: 0,\r\n      points: tool === 'freedraw' ? [point] : []\r\n    };\r\n\r\n    if (tool === 'text') {\r\n      this.handleTextInput(point);\r\n    }\r\n  }\r\n\r\n  onMouseMove(event: MouseEvent): void {\r\n    if (this.isPanning) {\r\n      const dx = event.clientX - this.lastPanPoint.x;\r\n      const dy = event.clientY - this.lastPanPoint.y;\r\n      const pan = this.canvasService.pan;\r\n      this.canvasService.setPan({ x: pan.x + dx, y: pan.y + dy });\r\n      this.lastPanPoint = { x: event.clientX, y: event.clientY };\r\n      return;\r\n    }\r\n\r\n    if (!this.isDrawing || !this.currentElement) return;\r\n\r\n    const point = this.getCanvasPoint(event);\r\n    const tool = this.toolService.currentTool;\r\n\r\n    if (tool === 'freedraw') {\r\n      this.currentElement.points!.push(point);\r\n    } else {\r\n      this.currentElement.width = point.x - this.startPoint.x;\r\n      this.currentElement.height = point.y - this.startPoint.y;\r\n    }\r\n\r\n    this.render();\r\n    if (this.currentElement) {\r\n      this.drawElement(this.currentElement);\r\n    }\r\n  }\r\n\r\n  onMouseUp(event: MouseEvent): void {\r\n    if (this.isPanning) {\r\n      this.isPanning = false;\r\n      return;\r\n    }\r\n\r\n    if (!this.isDrawing || !this.currentElement) return;\r\n\r\n    if (this.toolService.currentTool !== 'text') {\r\n      this.canvasService.addElement(this.currentElement);\r\n      this.historyService.addState(this.canvasService.getState());\r\n    }\r\n\r\n    this.isDrawing = false;\r\n    this.currentElement = null;\r\n  }\r\n\r\n  @HostListener('wheel', ['$event'])\r\n  onWheel(event: WheelEvent): void {\r\n    if (event.ctrlKey) {\r\n      event.preventDefault();\r\n      const delta = event.deltaY > 0 ? 0.9 : 1.1;\r\n      this.canvasService.setZoom(this.canvasService.zoom * delta);\r\n    }\r\n  }\r\n\r\n  private getCanvasPoint(event: MouseEvent): Point {\r\n    const canvas = this.canvasRef.nativeElement;\r\n    const rect = canvas.getBoundingClientRect();\r\n    const zoom = this.canvasService.zoom;\r\n    const pan = this.canvasService.pan;\r\n\r\n    return {\r\n      x: (event.clientX - rect.left - pan.x) / zoom,\r\n      y: (event.clientY - rect.top - pan.y) / zoom\r\n    };\r\n  }\r\n\r\n  private handleSelection(point: Point, addToSelection: boolean): void {\r\n    const elements = this.canvasService.elements;\r\n    \r\n    for (let i = elements.length - 1; i >= 0; i--) {\r\n      const el = elements[i];\r\n      if (this.isPointInElement(point, el)) {\r\n        this.canvasService.selectElement(el.id, addToSelection);\r\n        return;\r\n      }\r\n    }\r\n\r\n    if (!addToSelection) {\r\n      this.canvasService.clearSelection();\r\n    }\r\n  }\r\n\r\n  private isPointInElement(point: Point, element: DrawingElement): boolean {\r\n    if (element.type === 'freedraw') {\r\n      return element.points?.some(p =>\r\n        Math.abs(p.x - point.x) < 10 && Math.abs(p.y - point.y) < 10\r\n      ) || false;\r\n    }\r\n\r\n    const x = element.x;\r\n    const y = element.y;\r\n    const w = element.width || 0;\r\n    const h = element.height || 0;\r\n\r\n    return point.x >= Math.min(x, x + w) &&\r\n           point.x <= Math.max(x, x + w) &&\r\n           point.y >= Math.min(y, y + h) &&\r\n           point.y <= Math.max(y, y + h);\r\n  }\r\n\r\n  private handleTextInput(point: Point): void {\r\n    const text = prompt('Digite o texto:');\r\n    if (text && this.currentElement) {\r\n      this.currentElement.text = text;\r\n      this.currentElement.width = text.length * 10;\r\n      this.currentElement.height = 20;\r\n      this.canvasService.addElement(this.currentElement);\r\n      this.historyService.addState(this.canvasService.getState());\r\n    }\r\n    this.isDrawing = false;\r\n    this.currentElement = null;\r\n  }\r\n\r\n  private render(): void {\r\n    const canvas = this.canvasRef.nativeElement;\r\n    this.ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n    this.ctx.save();\r\n    const zoom = this.canvasService.zoom;\r\n    const pan = this.canvasService.pan;\r\n    this.ctx.translate(pan.x, pan.y);\r\n    this.ctx.scale(zoom, zoom);\r\n\r\n    this.canvasService.elements.forEach(element => {\r\n      this.drawElement(element);\r\n    });\r\n\r\n    this.ctx.restore();\r\n  }\r\n\r\n  private drawElement(element: DrawingElement): void {\r\n    this.ctx.save();\r\n    this.ctx.strokeStyle = element.strokeColor;\r\n    this.ctx.fillStyle = element.fillColor;\r\n    this.ctx.lineWidth = element.strokeWidth;\r\n\r\n    if (element.isSelected) {\r\n      this.ctx.strokeStyle = '#4CAF50';\r\n      this.ctx.lineWidth = element.strokeWidth + 2;\r\n    }\r\n\r\n    switch (element.type) {\r\n      case 'rectangle':\r\n        this.drawRectangle(element);\r\n        break;\r\n      case 'circle':\r\n        this.drawCircle(element);\r\n        break;\r\n      case 'ellipse':\r\n        this.drawEllipse(element);\r\n        break;\r\n      case 'line':\r\n        this.drawLine(element);\r\n        break;\r\n      case 'arrow':\r\n        this.drawArrow(element);\r\n        break;\r\n      case 'freedraw':\r\n        this.drawFreeDraw(element);\r\n        break;\r\n      case 'text':\r\n        this.drawText(element);\r\n        break;\r\n    }\r\n\r\n    this.ctx.restore();\r\n  }\r\n\r\n  private drawRectangle(element: DrawingElement): void {\r\n    const w = element.width || 0;\r\n    const h = element.height || 0;\r\n    this.ctx.fillRect(element.x, element.y, w, h);\r\n    this.ctx.strokeRect(element.x, element.y, w, h);\r\n  }\r\n\r\n  private drawCircle(element: DrawingElement): void {\r\n    const radius = Math.abs(element.width || 0) / 2;\r\n    const centerX = element.x + (element.width || 0) / 2;\r\n    const centerY = element.y + (element.height || 0) / 2;\r\n    \r\n    this.ctx.beginPath();\r\n    this.ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);\r\n    this.ctx.fill();\r\n    this.ctx.stroke();\r\n  }\r\n\r\n  private drawEllipse(element: DrawingElement): void {\r\n    const radiusX = Math.abs(element.width || 0) / 2;\r\n    const radiusY = Math.abs(element.height || 0) / 2;\r\n    const centerX = element.x + (element.width || 0) / 2;\r\n    const centerY = element.y + (element.height || 0) / 2;\r\n    \r\n    this.ctx.beginPath();\r\n    this.ctx.ellipse(centerX, centerY, radiusX, radiusY, 0, 0, Math.PI * 2);\r\n    this.ctx.fill();\r\n    this.ctx.stroke();\r\n  }\r\n\r\n  private drawLine(element: DrawingElement): void {\r\n    const endX = element.x + (element.width || 0);\r\n    const endY = element.y + (element.height || 0);\r\n    \r\n    this.ctx.beginPath();\r\n    this.ctx.moveTo(element.x, element.y);\r\n    this.ctx.lineTo(endX, endY);\r\n    this.ctx.stroke();\r\n  }\r\n\r\n  private drawArrow(element: DrawingElement): void {\r\n    const endX = element.x + (element.width || 0);\r\n    const endY = element.y + (element.height || 0);\r\n    \r\n    // Draw line\r\n    this.ctx.beginPath();\r\n    this.ctx.moveTo(element.x, element.y);\r\n    this.ctx.lineTo(endX, endY);\r\n    this.ctx.stroke();\r\n\r\n    // Draw arrowhead\r\n    const angle = Math.atan2(endY - element.y, endX - element.x);\r\n    const headLength = 15;\r\n    \r\n    this.ctx.beginPath();\r\n    this.ctx.moveTo(endX, endY);\r\n    this.ctx.lineTo(\r\n      endX - headLength * Math.cos(angle - Math.PI / 6),\r\n      endY - headLength * Math.sin(angle - Math.PI / 6)\r\n    );\r\n    this.ctx.moveTo(endX, endY);\r\n    this.ctx.lineTo(\r\n      endX - headLength * Math.cos(angle + Math.PI / 6),\r\n      endY - headLength * Math.sin(angle + Math.PI / 6)\r\n    );\r\n    this.ctx.stroke();\r\n  }\r\n\r\n  private drawFreeDraw(element: DrawingElement): void {\r\n    if (!element.points || element.points.length < 2) return;\r\n\r\n    this.ctx.beginPath();\r\n    this.ctx.moveTo(element.points[0].x, element.points[0].y);\r\n    \r\n    for (let i = 1; i < element.points.length; i++) {\r\n      this.ctx.lineTo(element.points[i].x, element.points[i].y);\r\n    }\r\n    \r\n    this.ctx.stroke();\r\n  }\r\n\r\n  private drawText(element: DrawingElement): void {\r\n    if (!element.text) return;\r\n    \r\n    this.ctx.font = '16px Arial';\r\n    this.ctx.fillStyle = element.strokeColor;\r\n    this.ctx.fillText(element.text, element.x, element.y + 16);\r\n    \r\n    if (element.isSelected) {\r\n      this.ctx.strokeRect(element.x - 2, element.y, element.width || 0, element.height || 0);\r\n    }\r\n  }\r\n}\r\n","<div class=\"canvas-container\">\r\n  <canvas\r\n    #canvas\r\n    (mousedown)=\"onMouseDown($event)\"\r\n    (mousemove)=\"onMouseMove($event)\"\r\n    (mouseup)=\"onMouseUp($event)\"\r\n  ></canvas>\r\n</div>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}