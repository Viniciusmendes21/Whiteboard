{"ast":null,"code":"import { BehaviorSubject } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nexport class CanvasService {\n  constructor() {\n    this.elementsSubject = new BehaviorSubject([]);\n    this.zoomSubject = new BehaviorSubject(1);\n    this.panSubject = new BehaviorSubject({\n      x: 0,\n      y: 0\n    });\n    this.snapToGridSubject = new BehaviorSubject(false);\n    this.gridSizeSubject = new BehaviorSubject(20);\n    this.themeSubject = new BehaviorSubject('light');\n    this.isApplyingRemote = false;\n    this.instanceId = `${Date.now()}-${Math.random().toString(36).slice(2)}`;\n    this.elements$ = this.elementsSubject.asObservable();\n    this.zoom$ = this.zoomSubject.asObservable();\n    this.pan$ = this.panSubject.asObservable();\n    this.snapToGrid$ = this.snapToGridSubject.asObservable();\n    this.gridSize$ = this.gridSizeSubject.asObservable();\n    this.theme$ = this.themeSubject.asObservable();\n    this.setupBroadcast();\n    this.applyTheme(this.themeSubject.value);\n  }\n  get elements() {\n    return this.elementsSubject.value;\n  }\n  get zoom() {\n    return this.zoomSubject.value;\n  }\n  get pan() {\n    return this.panSubject.value;\n  }\n  get snapToGrid() {\n    return this.snapToGridSubject.value;\n  }\n  get gridSize() {\n    return this.gridSizeSubject.value;\n  }\n  get theme() {\n    return this.themeSubject.value;\n  }\n  addElement(element) {\n    const zIndex = element.zIndex ?? (this.elements.length ? Math.max(...this.elements.map(e => e.zIndex ?? 0)) + 1 : 0);\n    const elements = [...this.elements, {\n      ...element,\n      zIndex\n    }];\n    this.elementsSubject.next(elements);\n  }\n  updateElement(id, updates) {\n    const elements = this.elements.map(el => el.id === id ? {\n      ...el,\n      ...updates\n    } : el);\n    this.elementsSubject.next(elements);\n  }\n  deleteElement(id) {\n    const elements = this.elements.filter(el => el.id !== id);\n    this.elementsSubject.next(elements);\n  }\n  deleteSelectedElements() {\n    const elements = this.elements.filter(el => !el.isSelected);\n    this.elementsSubject.next(elements);\n    this.normalizeZIndices();\n  }\n  clearSelection() {\n    const elements = this.elements.map(el => ({\n      ...el,\n      isSelected: false\n    }));\n    this.elementsSubject.next(elements);\n  }\n  selectElement(id, addToSelection = false) {\n    const elements = this.elements.map(el => ({\n      ...el,\n      isSelected: el.id === id ? true : addToSelection ? el.isSelected : false\n    }));\n    this.elementsSubject.next(elements);\n  }\n  setZoom(zoom) {\n    this.zoomSubject.next(Math.max(0.1, Math.min(5, zoom)));\n  }\n  setPan(pan) {\n    this.panSubject.next(pan);\n  }\n  setSnapToGrid(enabled) {\n    this.snapToGridSubject.next(enabled);\n  }\n  setGridSize(size) {\n    const clamped = Math.max(5, Math.min(200, size));\n    this.gridSizeSubject.next(clamped);\n  }\n  clear() {\n    this.elementsSubject.next([]);\n    this.zoomSubject.next(1);\n    this.panSubject.next({\n      x: 0,\n      y: 0\n    });\n    this.snapToGridSubject.next(false);\n    this.gridSizeSubject.next(20);\n    this.themeSubject.next('light');\n  }\n  getState() {\n    return {\n      elements: [...this.elements],\n      zoom: this.zoom,\n      panX: this.pan.x,\n      panY: this.pan.y,\n      snapToGrid: this.snapToGrid,\n      gridSize: this.gridSize\n    };\n  }\n  setState(state) {\n    this.elementsSubject.next([...state.elements]);\n    this.zoomSubject.next(state.zoom);\n    this.panSubject.next({\n      x: state.panX,\n      y: state.panY\n    });\n    this.snapToGridSubject.next(!!state.snapToGrid);\n    this.gridSizeSubject.next(state.gridSize ?? 20);\n  }\n  exportToJSON() {\n    return JSON.stringify(this.getState(), null, 2);\n  }\n  importFromJSON(json) {\n    try {\n      const state = JSON.parse(json);\n      this.setState(state);\n      return true;\n    } catch {\n      return false;\n    }\n  }\n  generateId() {\n    return `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n  }\n  static {\n    this.ɵfac = function CanvasService_Factory(t) {\n      return new (t || CanvasService)();\n    };\n  }\n  static {\n    this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: CanvasService,\n      factory: CanvasService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n}","map":{"version":3,"names":["BehaviorSubject","CanvasService","constructor","elementsSubject","zoomSubject","panSubject","x","y","snapToGridSubject","gridSizeSubject","themeSubject","isApplyingRemote","instanceId","Date","now","Math","random","toString","slice","elements$","asObservable","zoom$","pan$","snapToGrid$","gridSize$","theme$","setupBroadcast","applyTheme","value","elements","zoom","pan","snapToGrid","gridSize","theme","addElement","element","zIndex","length","max","map","e","next","updateElement","id","updates","el","deleteElement","filter","deleteSelectedElements","isSelected","normalizeZIndices","clearSelection","selectElement","addToSelection","setZoom","min","setPan","setSnapToGrid","enabled","setGridSize","size","clamped","clear","getState","panX","panY","setState","state","exportToJSON","JSON","stringify","importFromJSON","json","parse","generateId","substr","factory","ɵfac","providedIn"],"sources":["C:\\Users\\vinic\\Desktop\\Estagio\\Teste\\src\\app\\services\\canvas.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\r\nimport { BehaviorSubject, Observable, combineLatest } from 'rxjs';\r\nimport { CanvasState, DrawingElement, Point } from '../models/drawing.model';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class CanvasService {\r\n  private elementsSubject = new BehaviorSubject<DrawingElement[]>([]);\r\n  private zoomSubject = new BehaviorSubject<number>(1);\r\n  private panSubject = new BehaviorSubject<Point>({ x: 0, y: 0 });\r\n  private snapToGridSubject = new BehaviorSubject<boolean>(false);\r\n  private gridSizeSubject = new BehaviorSubject<number>(20);\r\n  private themeSubject = new BehaviorSubject<'light' | 'dark'>('light');\r\n\r\n  private broadcastChannel?: BroadcastChannel;\r\n  private isApplyingRemote = false;\r\n  private instanceId = `${Date.now()}-${Math.random().toString(36).slice(2)}`;\r\n\r\n  elements$: Observable<DrawingElement[]> = this.elementsSubject.asObservable();\r\n  zoom$: Observable<number> = this.zoomSubject.asObservable();\r\n  pan$: Observable<Point> = this.panSubject.asObservable();\r\n  snapToGrid$: Observable<boolean> = this.snapToGridSubject.asObservable();\r\n  gridSize$: Observable<number> = this.gridSizeSubject.asObservable();\r\n  theme$: Observable<'light' | 'dark'> = this.themeSubject.asObservable();\r\n\r\n  constructor() {\r\n    this.setupBroadcast();\r\n    this.applyTheme(this.themeSubject.value);\r\n  }\r\n\r\n  get elements(): DrawingElement[] {\r\n    return this.elementsSubject.value;\r\n  }\r\n\r\n  get zoom(): number {\r\n    return this.zoomSubject.value;\r\n  }\r\n\r\n  get pan(): Point {\r\n    return this.panSubject.value;\r\n  }\r\n\r\n  get snapToGrid(): boolean {\r\n    return this.snapToGridSubject.value;\r\n  }\r\n\r\n  get gridSize(): number {\r\n    return this.gridSizeSubject.value;\r\n  }\r\n\r\n  get theme(): 'light' | 'dark' {\r\n    return this.themeSubject.value;\r\n  }\r\n\r\n  addElement(element: DrawingElement): void {\r\n    const zIndex = element.zIndex ?? (this.elements.length ? Math.max(...this.elements.map(e => e.zIndex ?? 0)) + 1 : 0);\r\n    const elements = [...this.elements, { ...element, zIndex }];\r\n    this.elementsSubject.next(elements);\r\n  }\r\n\r\n  updateElement(id: string, updates: Partial<DrawingElement>): void {\r\n    const elements = this.elements.map(el =>\r\n      el.id === id ? { ...el, ...updates } : el\r\n    );\r\n    this.elementsSubject.next(elements);\r\n  }\r\n\r\n  deleteElement(id: string): void {\r\n    const elements = this.elements.filter(el => el.id !== id);\r\n    this.elementsSubject.next(elements);\r\n  }\r\n\r\n  deleteSelectedElements(): void {\r\n    const elements = this.elements.filter(el => !el.isSelected);\r\n    this.elementsSubject.next(elements);\r\n    this.normalizeZIndices();\r\n  }\r\n\r\n  clearSelection(): void {\r\n    const elements = this.elements.map(el => ({ ...el, isSelected: false }));\r\n    this.elementsSubject.next(elements);\r\n  }\r\n\r\n  selectElement(id: string, addToSelection = false): void {\r\n    const elements = this.elements.map(el => ({\r\n      ...el,\r\n      isSelected: el.id === id ? true : (addToSelection ? el.isSelected : false)\r\n    }));\r\n    this.elementsSubject.next(elements);\r\n  }\r\n\r\n  setZoom(zoom: number): void {\r\n    this.zoomSubject.next(Math.max(0.1, Math.min(5, zoom)));\r\n  }\r\n\r\n  setPan(pan: Point): void {\r\n    this.panSubject.next(pan);\r\n  }\r\n\r\n  setSnapToGrid(enabled: boolean): void {\r\n    this.snapToGridSubject.next(enabled);\r\n  }\r\n\r\n  setGridSize(size: number): void {\r\n    const clamped = Math.max(5, Math.min(200, size));\r\n    this.gridSizeSubject.next(clamped);\r\n  }\r\n\r\n  clear(): void {\r\n    this.elementsSubject.next([]);\r\n    this.zoomSubject.next(1);\r\n    this.panSubject.next({ x: 0, y: 0 });\r\n    this.snapToGridSubject.next(false);\r\n    this.gridSizeSubject.next(20);\r\n    this.themeSubject.next('light');\r\n  }\r\n\r\n  getState(): CanvasState {\r\n    return {\r\n      elements: [...this.elements],\r\n      zoom: this.zoom,\r\n      panX: this.pan.x,\r\n      panY: this.pan.y,\r\n      snapToGrid: this.snapToGrid,\r\n      gridSize: this.gridSize\r\n    };\r\n  }\r\n\r\n  setState(state: CanvasState): void {\r\n    this.elementsSubject.next([...state.elements]);\r\n    this.zoomSubject.next(state.zoom);\r\n    this.panSubject.next({ x: state.panX, y: state.panY });\r\n    this.snapToGridSubject.next(!!state.snapToGrid);\r\n    this.gridSizeSubject.next(state.gridSize ?? 20);\r\n  }\r\n\r\n  exportToJSON(): string {\r\n    return JSON.stringify(this.getState(), null, 2);\r\n  }\r\n\r\n  importFromJSON(json: string): boolean {\r\n    try {\r\n      const state = JSON.parse(json);\r\n      this.setState(state);\r\n      return true;\r\n    } catch {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  generateId(): string {\r\n    return `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\r\n  }\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}