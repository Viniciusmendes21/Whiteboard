{"ast":null,"code":"import * as i0 from \"@angular/core\";\nimport * as i1 from \"../../services/canvas.service\";\nimport * as i2 from \"../../services/history.service\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"@angular/forms\";\nfunction AiChatComponent_span_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 7);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(ctx_r0.message);\n  }\n}\nexport let AiChatComponent = /*#__PURE__*/(() => {\n  class AiChatComponent {\n    constructor(canvasService, historyService) {\n      this.canvasService = canvasService;\n      this.historyService = historyService;\n      this.prompt = '';\n      this.isBusy = false;\n      this.message = '';\n    }\n    generate() {\n      const text = this.prompt.trim();\n      if (!text) {\n        this.message = 'Digite uma descrição para gerar o diagrama.';\n        return;\n      }\n      this.isBusy = true;\n      try {\n        const nodes = this.parseNodes(text);\n        if (!nodes.length) {\n          this.message = 'Não encontrei passos ou nós para desenhar.';\n          this.isBusy = false;\n          return;\n        }\n        this.addDiagram(nodes);\n        this.message = 'Diagrama gerado. Ajuste os elementos se quiser.';\n      } catch (err) {\n        this.message = 'Erro ao gerar diagrama.';\n      } finally {\n        this.isBusy = false;\n      }\n    }\n    clearPrompt() {\n      this.prompt = '';\n      this.message = '';\n    }\n    parseNodes(text) {\n      // Split by arrows, new lines or commas to guess steps\n      const separators = /->|⇒|➜|→|=>|\\n|\\r|,/g;\n      const raw = text.split(separators).map(part => part.trim()).filter(Boolean);\n      const nodes = raw.map(label => {\n        const lower = label.toLowerCase();\n        if (lower.includes('início') || lower.includes('inicio') || lower.includes('start') || lower.includes('fim') || lower.includes('end')) {\n          return {\n            label,\n            shape: 'ellipse'\n          };\n        }\n        if (lower.includes('decisão') || lower.includes('decision') || lower.includes('if')) {\n          return {\n            label,\n            shape: 'ellipse'\n          };\n        }\n        return {\n          label,\n          shape: 'rectangle'\n        };\n      });\n      return nodes;\n    }\n    addDiagram(nodes) {\n      const baseX = 80;\n      const baseY = 140;\n      const gapX = 220;\n      const width = 160;\n      const height = 80;\n      const elements = [];\n      nodes.forEach((node, idx) => {\n        const x = baseX + idx * gapX;\n        const y = baseY;\n        elements.push({\n          id: this.canvasService.generateId(),\n          type: node.shape,\n          x,\n          y,\n          width,\n          height,\n          strokeColor: '#111',\n          fillColor: '#fefefe',\n          strokeWidth: 3,\n          rotation: 0,\n          text: node.label,\n          fontSize: 16,\n          fontFamily: 'Segoe UI',\n          fontWeight: 'bold',\n          fontStyle: 'normal'\n        });\n        if (idx < nodes.length - 1) {\n          const nextX = baseX + (idx + 1) * gapX;\n          elements.push({\n            id: this.canvasService.generateId(),\n            type: 'arrow',\n            x: x + width,\n            y: y + height / 2,\n            width: nextX - (x + width),\n            height: 0,\n            strokeColor: '#444',\n            fillColor: '#444',\n            strokeWidth: 3,\n            rotation: 0\n          });\n        }\n      });\n      // Push elements in order to canvas\n      elements.forEach(el => this.canvasService.addElement(el));\n      this.historyService.addState(this.canvasService.getState());\n    }\n    static {\n      this.ɵfac = function AiChatComponent_Factory(t) {\n        return new (t || AiChatComponent)(i0.ɵɵdirectiveInject(i1.CanvasService), i0.ɵɵdirectiveInject(i2.HistoryService));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: AiChatComponent,\n        selectors: [[\"app-ai-chat\"]],\n        decls: 11,\n        vars: 4,\n        consts: [[1, \"ai-chat\"], [1, \"ai-chat__header\"], [\"title\", \"Limpar entrada\", 1, \"link\", 3, \"click\"], [\"placeholder\", \"Descreva o fluxo: ex. In\\u00EDcio -> Autenticar -> Decis\\u00E3o -> Aprovar -> Fim\", \"rows\", \"4\", 3, \"ngModelChange\", \"ngModel\"], [1, \"ai-chat__actions\"], [3, \"click\", \"disabled\"], [\"class\", \"ai-chat__message\", 4, \"ngIf\"], [1, \"ai-chat__message\"]],\n        template: function AiChatComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"span\");\n            i0.ɵɵtext(3, \"\\uD83E\\uDD16 Assistente IA (beta)\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(4, \"button\", 2);\n            i0.ɵɵlistener(\"click\", function AiChatComponent_Template_button_click_4_listener() {\n              return ctx.clearPrompt();\n            });\n            i0.ɵɵtext(5, \"Limpar\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(6, \"textarea\", 3);\n            i0.ɵɵtwoWayListener(\"ngModelChange\", function AiChatComponent_Template_textarea_ngModelChange_6_listener($event) {\n              i0.ɵɵtwoWayBindingSet(ctx.prompt, $event) || (ctx.prompt = $event);\n              return $event;\n            });\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(7, \"div\", 4)(8, \"button\", 5);\n            i0.ɵɵlistener(\"click\", function AiChatComponent_Template_button_click_8_listener() {\n              return ctx.generate();\n            });\n            i0.ɵɵtext(9);\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(10, AiChatComponent_span_10_Template, 2, 1, \"span\", 6);\n            i0.ɵɵelementEnd()();\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(6);\n            i0.ɵɵtwoWayProperty(\"ngModel\", ctx.prompt);\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"disabled\", ctx.isBusy);\n            i0.ɵɵadvance();\n            i0.ɵɵtextInterpolate(ctx.isBusy ? \"Gerando...\" : \"Gerar diagrama\");\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.message);\n          }\n        },\n        dependencies: [i3.NgIf, i4.DefaultValueAccessor, i4.NgControlStatus, i4.NgModel],\n        styles: [\".ai-chat[_ngcontent-%COMP%]{position:absolute;right:16px;bottom:16px;width:340px;background:var(--surface);color:var(--text);border:1px solid var(--border);border-radius:10px;box-shadow:0 8px 20px #00000026;padding:12px 14px;display:flex;flex-direction:column;gap:10px;z-index:120}.ai-chat__header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;font-weight:600}textarea[_ngcontent-%COMP%]{width:100%;border-radius:8px;border:1px solid var(--border);padding:10px;resize:vertical;min-height:90px;background:var(--surface);color:var(--text)}.ai-chat__actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}button[_ngcontent-%COMP%]{padding:8px 12px;border-radius:6px;border:1px solid var(--border);background:#4caf50;color:#fff;cursor:pointer;transition:opacity .2s ease}button[_ngcontent-%COMP%]:disabled{opacity:.7;cursor:not-allowed}.ai-chat__message[_ngcontent-%COMP%]{font-size:.85rem;color:var(--text)}button.link[_ngcontent-%COMP%]{background:transparent;color:var(--text);border:none;padding:4px 8px;cursor:pointer}\"]\n      });\n    }\n  }\n  return AiChatComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}