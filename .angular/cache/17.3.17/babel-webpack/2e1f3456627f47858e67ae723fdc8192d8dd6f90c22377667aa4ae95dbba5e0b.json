{"ast":null,"code":"import { BehaviorSubject } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nexport class HistoryService {\n  constructor() {\n    this.history = [];\n    this.currentIndex = -1;\n    this.maxHistorySize = 50;\n    this.canUndoSubject = new BehaviorSubject(false);\n    this.canRedoSubject = new BehaviorSubject(false);\n    this.canUndo$ = this.canUndoSubject.asObservable();\n    this.canRedo$ = this.canRedoSubject.asObservable();\n  }\n  addState(state) {\n    // Remove any states after current index\n    this.history = this.history.slice(0, this.currentIndex + 1);\n    // Add new state\n    this.history.push(this.deepClone(state));\n    this.currentIndex++;\n    // Limit history size\n    if (this.history.length > this.maxHistorySize) {\n      this.history.shift();\n      this.currentIndex--;\n    }\n    this.updateCanUndoRedo();\n  }\n  undo() {\n    if (this.currentIndex > 0) {\n      this.currentIndex--;\n      this.updateCanUndoRedo();\n      return this.deepClone(this.history[this.currentIndex]);\n    }\n    return null;\n  }\n  redo() {\n    if (this.currentIndex < this.history.length - 1) {\n      this.currentIndex++;\n      this.updateCanUndoRedo();\n      return this.deepClone(this.history[this.currentIndex]);\n    }\n    return null;\n  }\n  clear() {\n    this.history = [];\n    this.currentIndex = -1;\n    this.updateCanUndoRedo();\n  }\n  updateCanUndoRedo() {\n    this.canUndoSubject.next(this.currentIndex > 0);\n    this.canRedoSubject.next(this.currentIndex < this.history.length - 1);\n  }\n  deepClone(obj) {\n    return JSON.parse(JSON.stringify(obj));\n  }\n  static {\n    this.ɵfac = function HistoryService_Factory(t) {\n      return new (t || HistoryService)();\n    };\n  }\n  static {\n    this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: HistoryService,\n      factory: HistoryService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n}","map":{"version":3,"names":["BehaviorSubject","HistoryService","constructor","history","currentIndex","maxHistorySize","canUndoSubject","canRedoSubject","canUndo$","asObservable","canRedo$","addState","state","slice","push","deepClone","length","shift","updateCanUndoRedo","undo","redo","clear","next","obj","JSON","parse","stringify","factory","ɵfac","providedIn"],"sources":["C:\\Users\\vinic\\Desktop\\Estagio\\Teste\\src\\app\\services\\history.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\r\nimport { BehaviorSubject, Observable } from 'rxjs';\r\nimport { CanvasState, DrawingElement } from '../models/drawing.model';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class HistoryService {\r\n  private history: CanvasState[] = [];\r\n  private currentIndex = -1;\r\n  private maxHistorySize = 50;\r\n\r\n  private canUndoSubject = new BehaviorSubject<boolean>(false);\r\n  private canRedoSubject = new BehaviorSubject<boolean>(false);\r\n\r\n  canUndo$: Observable<boolean> = this.canUndoSubject.asObservable();\r\n  canRedo$: Observable<boolean> = this.canRedoSubject.asObservable();\r\n\r\n  addState(state: CanvasState): void {\r\n    // Remove any states after current index\r\n    this.history = this.history.slice(0, this.currentIndex + 1);\r\n    \r\n    // Add new state\r\n    this.history.push(this.deepClone(state));\r\n    this.currentIndex++;\r\n\r\n    // Limit history size\r\n    if (this.history.length > this.maxHistorySize) {\r\n      this.history.shift();\r\n      this.currentIndex--;\r\n    }\r\n\r\n    this.updateCanUndoRedo();\r\n  }\r\n\r\n  undo(): CanvasState | null {\r\n    if (this.currentIndex > 0) {\r\n      this.currentIndex--;\r\n      this.updateCanUndoRedo();\r\n      return this.deepClone(this.history[this.currentIndex]);\r\n    }\r\n    return null;\r\n  }\r\n\r\n  redo(): CanvasState | null {\r\n    if (this.currentIndex < this.history.length - 1) {\r\n      this.currentIndex++;\r\n      this.updateCanUndoRedo();\r\n      return this.deepClone(this.history[this.currentIndex]);\r\n    }\r\n    return null;\r\n  }\r\n\r\n  clear(): void {\r\n    this.history = [];\r\n    this.currentIndex = -1;\r\n    this.updateCanUndoRedo();\r\n  }\r\n\r\n  private updateCanUndoRedo(): void {\r\n    this.canUndoSubject.next(this.currentIndex > 0);\r\n    this.canRedoSubject.next(this.currentIndex < this.history.length - 1);\r\n  }\r\n\r\n  private deepClone<T>(obj: T): T {\r\n    return JSON.parse(JSON.stringify(obj));\r\n  }\r\n}\r\n"],"mappings":"AACA,SAASA,eAAe,QAAoB,MAAM;;AAMlD,OAAM,MAAOC,cAAc;EAH3BC,YAAA;IAIU,KAAAC,OAAO,GAAkB,EAAE;IAC3B,KAAAC,YAAY,GAAG,CAAC,CAAC;IACjB,KAAAC,cAAc,GAAG,EAAE;IAEnB,KAAAC,cAAc,GAAG,IAAIN,eAAe,CAAU,KAAK,CAAC;IACpD,KAAAO,cAAc,GAAG,IAAIP,eAAe,CAAU,KAAK,CAAC;IAE5D,KAAAQ,QAAQ,GAAwB,IAAI,CAACF,cAAc,CAACG,YAAY,EAAE;IAClE,KAAAC,QAAQ,GAAwB,IAAI,CAACH,cAAc,CAACE,YAAY,EAAE;;EAElEE,QAAQA,CAACC,KAAkB;IACzB;IACA,IAAI,CAACT,OAAO,GAAG,IAAI,CAACA,OAAO,CAACU,KAAK,CAAC,CAAC,EAAE,IAAI,CAACT,YAAY,GAAG,CAAC,CAAC;IAE3D;IACA,IAAI,CAACD,OAAO,CAACW,IAAI,CAAC,IAAI,CAACC,SAAS,CAACH,KAAK,CAAC,CAAC;IACxC,IAAI,CAACR,YAAY,EAAE;IAEnB;IACA,IAAI,IAAI,CAACD,OAAO,CAACa,MAAM,GAAG,IAAI,CAACX,cAAc,EAAE;MAC7C,IAAI,CAACF,OAAO,CAACc,KAAK,EAAE;MACpB,IAAI,CAACb,YAAY,EAAE;;IAGrB,IAAI,CAACc,iBAAiB,EAAE;EAC1B;EAEAC,IAAIA,CAAA;IACF,IAAI,IAAI,CAACf,YAAY,GAAG,CAAC,EAAE;MACzB,IAAI,CAACA,YAAY,EAAE;MACnB,IAAI,CAACc,iBAAiB,EAAE;MACxB,OAAO,IAAI,CAACH,SAAS,CAAC,IAAI,CAACZ,OAAO,CAAC,IAAI,CAACC,YAAY,CAAC,CAAC;;IAExD,OAAO,IAAI;EACb;EAEAgB,IAAIA,CAAA;IACF,IAAI,IAAI,CAAChB,YAAY,GAAG,IAAI,CAACD,OAAO,CAACa,MAAM,GAAG,CAAC,EAAE;MAC/C,IAAI,CAACZ,YAAY,EAAE;MACnB,IAAI,CAACc,iBAAiB,EAAE;MACxB,OAAO,IAAI,CAACH,SAAS,CAAC,IAAI,CAACZ,OAAO,CAAC,IAAI,CAACC,YAAY,CAAC,CAAC;;IAExD,OAAO,IAAI;EACb;EAEAiB,KAAKA,CAAA;IACH,IAAI,CAAClB,OAAO,GAAG,EAAE;IACjB,IAAI,CAACC,YAAY,GAAG,CAAC,CAAC;IACtB,IAAI,CAACc,iBAAiB,EAAE;EAC1B;EAEQA,iBAAiBA,CAAA;IACvB,IAAI,CAACZ,cAAc,CAACgB,IAAI,CAAC,IAAI,CAAClB,YAAY,GAAG,CAAC,CAAC;IAC/C,IAAI,CAACG,cAAc,CAACe,IAAI,CAAC,IAAI,CAAClB,YAAY,GAAG,IAAI,CAACD,OAAO,CAACa,MAAM,GAAG,CAAC,CAAC;EACvE;EAEQD,SAASA,CAAIQ,GAAM;IACzB,OAAOC,IAAI,CAACC,KAAK,CAACD,IAAI,CAACE,SAAS,CAACH,GAAG,CAAC,CAAC;EACxC;;;uBA3DWtB,cAAc;IAAA;EAAA;;;aAAdA,cAAc;MAAA0B,OAAA,EAAd1B,cAAc,CAAA2B,IAAA;MAAAC,UAAA,EAFb;IAAM;EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}