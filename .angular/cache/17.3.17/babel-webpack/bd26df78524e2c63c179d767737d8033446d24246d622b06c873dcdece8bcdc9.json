{"ast":null,"code":"import { BehaviorSubject, combineLatest } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nexport class CanvasService {\n  constructor() {\n    this.elementsSubject = new BehaviorSubject([]);\n    this.zoomSubject = new BehaviorSubject(1);\n    this.panSubject = new BehaviorSubject({\n      x: 0,\n      y: 0\n    });\n    this.snapToGridSubject = new BehaviorSubject(false);\n    this.gridSizeSubject = new BehaviorSubject(20);\n    this.themeSubject = new BehaviorSubject('light');\n    this.isApplyingRemote = false;\n    this.instanceId = `${Date.now()}-${Math.random().toString(36).slice(2)}`;\n    this.elements$ = this.elementsSubject.asObservable();\n    this.zoom$ = this.zoomSubject.asObservable();\n    this.pan$ = this.panSubject.asObservable();\n    this.snapToGrid$ = this.snapToGridSubject.asObservable();\n    this.gridSize$ = this.gridSizeSubject.asObservable();\n    this.theme$ = this.themeSubject.asObservable();\n    this.setupBroadcast();\n    this.applyTheme(this.themeSubject.value);\n  }\n  get elements() {\n    return this.elementsSubject.value;\n  }\n  get zoom() {\n    return this.zoomSubject.value;\n  }\n  get pan() {\n    return this.panSubject.value;\n  }\n  get snapToGrid() {\n    return this.snapToGridSubject.value;\n  }\n  get gridSize() {\n    return this.gridSizeSubject.value;\n  }\n  get theme() {\n    return this.themeSubject.value;\n  }\n  addElement(element) {\n    const zIndex = element.zIndex ?? (this.elements.length ? Math.max(...this.elements.map(e => e.zIndex ?? 0)) + 1 : 0);\n    const elements = [...this.elements, {\n      ...element,\n      zIndex\n    }];\n    this.elementsSubject.next(elements);\n  }\n  updateElement(id, updates) {\n    const elements = this.elements.map(el => el.id === id ? {\n      ...el,\n      ...updates\n    } : el);\n    this.elementsSubject.next(elements);\n  }\n  updateSelectedTextStyle(style) {\n    const elements = this.elements.map(el => {\n      if (!el.isSelected || !el.text) return el;\n      return {\n        ...el,\n        fontSize: style.fontSize ?? el.fontSize,\n        fontFamily: style.fontFamily ?? el.fontFamily,\n        fontWeight: style.fontWeight ?? el.fontWeight,\n        fontStyle: style.fontStyle ?? el.fontStyle,\n        strokeColor: style.strokeColor ?? el.strokeColor\n      };\n    });\n    this.elementsSubject.next(elements);\n  }\n  updateSelectedDimensions(dimensions) {\n    const elements = this.elements.map(el => {\n      if (!el.isSelected) return el;\n      return {\n        ...el,\n        width: dimensions.width ?? el.width,\n        height: dimensions.height ?? el.height\n      };\n    });\n    this.elementsSubject.next(elements);\n  }\n  setElements(elements) {\n    this.elementsSubject.next(elements);\n  }\n  deleteElement(id) {\n    const elements = this.elements.filter(el => el.id !== id);\n    this.elementsSubject.next(elements);\n  }\n  deleteSelectedElements() {\n    const elements = this.elements.filter(el => !el.isSelected);\n    this.elementsSubject.next(elements);\n    this.normalizeZIndices();\n  }\n  clearSelection() {\n    const elements = this.elements.map(el => ({\n      ...el,\n      isSelected: false\n    }));\n    this.elementsSubject.next(elements);\n  }\n  selectElement(id, addToSelection = false) {\n    const elements = this.elements.map(el => ({\n      ...el,\n      isSelected: el.id === id ? true : addToSelection ? el.isSelected : false\n    }));\n    this.elementsSubject.next(elements);\n  }\n  setZoom(zoom) {\n    this.zoomSubject.next(Math.max(0.1, Math.min(5, zoom)));\n  }\n  setPan(pan) {\n    this.panSubject.next(pan);\n  }\n  setSnapToGrid(enabled) {\n    this.snapToGridSubject.next(enabled);\n  }\n  setGridSize(size) {\n    const clamped = Math.max(5, Math.min(200, size));\n    this.gridSizeSubject.next(clamped);\n  }\n  rotateSelected(deltaDeg) {\n    const elements = this.elements.map(el => el.isSelected ? {\n      ...el,\n      rotation: (el.rotation + deltaDeg) % 360\n    } : el);\n    this.elementsSubject.next(elements);\n  }\n  alignSelected(alignment) {\n    const selected = this.elements.filter(el => el.isSelected);\n    if (selected.length < 2) return;\n    const bounds = this.getBounds(selected);\n    const updated = this.elements.map(el => {\n      if (!el.isSelected) return el;\n      const w = el.width || 0;\n      const h = el.height || 0;\n      switch (alignment) {\n        case 'left':\n          return {\n            ...el,\n            x: bounds.minX\n          };\n        case 'right':\n          return {\n            ...el,\n            x: bounds.maxX - w\n          };\n        case 'top':\n          return {\n            ...el,\n            y: bounds.minY\n          };\n        case 'bottom':\n          return {\n            ...el,\n            y: bounds.maxY - h\n          };\n        case 'center':\n          return {\n            ...el,\n            x: bounds.minX + (bounds.width - w) / 2\n          };\n        case 'middle':\n          return {\n            ...el,\n            y: bounds.minY + (bounds.height - h) / 2\n          };\n      }\n    });\n    this.elementsSubject.next(updated);\n  }\n  distributeSelected(orientation) {\n    const selected = this.elements.filter(el => el.isSelected).sort((a, b) => orientation === 'horizontal' ? a.x - b.x : a.y - b.y);\n    if (selected.length < 3) return;\n    const bounds = this.getBounds(selected);\n    const gaps = selected.length - 1;\n    if (orientation === 'horizontal') {\n      const totalWidth = selected.reduce((sum, el) => sum + Math.abs(el.width || 0), 0);\n      const space = bounds.width - totalWidth;\n      let cursor = bounds.minX;\n      const updatedIds = new Set(selected.map(s => s.id));\n      const updated = this.elements.map(el => {\n        if (!updatedIds.has(el.id)) return el;\n        const w = Math.abs(el.width || 0);\n        const next = {\n          ...el,\n          x: cursor\n        };\n        cursor += w + space / gaps;\n        return next;\n      });\n      this.elementsSubject.next(updated);\n    } else {\n      const totalHeight = selected.reduce((sum, el) => sum + Math.abs(el.height || 0), 0);\n      const space = bounds.height - totalHeight;\n      let cursor = bounds.minY;\n      const updatedIds = new Set(selected.map(s => s.id));\n      const updated = this.elements.map(el => {\n        if (!updatedIds.has(el.id)) return el;\n        const h = Math.abs(el.height || 0);\n        const next = {\n          ...el,\n          y: cursor\n        };\n        cursor += h + space / gaps;\n        return next;\n      });\n      this.elementsSubject.next(updated);\n    }\n  }\n  groupSelected() {\n    const selected = this.elements.filter(el => el.isSelected);\n    if (selected.length < 2) return;\n    const groupId = `group-${Date.now()}-${Math.random().toString(36).slice(2)}`;\n    const elements = this.elements.map(el => el.isSelected ? {\n      ...el,\n      groupId\n    } : el);\n    this.elementsSubject.next(elements);\n  }\n  ungroupSelected() {\n    const elements = this.elements.map(el => el.isSelected ? {\n      ...el,\n      groupId: undefined\n    } : el);\n    this.elementsSubject.next(elements);\n  }\n  bringToFront() {\n    const selectedIds = new Set(this.elements.filter(el => el.isSelected).map(el => el.id));\n    if (!selectedIds.size) return;\n    const reordered = [...this.elements].sort((a, b) => (a.zIndex ?? 0) - (b.zIndex ?? 0)).map((el, idx) => ({\n      ...el,\n      zIndex: idx\n    }));\n    const max = reordered.length - 1;\n    const bumped = reordered.map(el => selectedIds.has(el.id) ? {\n      ...el,\n      zIndex: max + 1\n    } : el);\n    this.elementsSubject.next(this.sortByZIndex(bumped));\n    this.normalizeZIndices();\n  }\n  sendToBack() {\n    const selectedIds = new Set(this.elements.filter(el => el.isSelected).map(el => el.id));\n    if (!selectedIds.size) return;\n    const reordered = [...this.elements].sort((a, b) => (a.zIndex ?? 0) - (b.zIndex ?? 0)).map((el, idx) => ({\n      ...el,\n      zIndex: idx\n    }));\n    const bumped = reordered.map(el => selectedIds.has(el.id) ? {\n      ...el,\n      zIndex: -1\n    } : el);\n    this.elementsSubject.next(this.sortByZIndex(bumped));\n    this.normalizeZIndices();\n  }\n  insertTemplate(name) {\n    const baseX = 50;\n    const baseY = 80;\n    const palette = ['#FFEB3B', '#FFCDD2', '#C5E1A5', '#BBDEFB'];\n    let elements = [];\n    if (name === 'sticky-notes') {\n      elements = palette.map((color, idx) => ({\n        id: this.generateId(),\n        type: 'rectangle',\n        x: baseX + idx * 140,\n        y: baseY,\n        width: 120,\n        height: 120,\n        strokeColor: '#444',\n        fillColor: color,\n        strokeWidth: 2,\n        rotation: 0,\n        text: 'Nota'\n      }));\n    } else {\n      elements = [{\n        id: this.generateId(),\n        type: 'rectangle',\n        x: baseX,\n        y: baseY,\n        width: 160,\n        height: 90,\n        strokeColor: '#1976d2',\n        fillColor: '#E3F2FD',\n        strokeWidth: 2,\n        rotation: 0,\n        text: 'Início'\n      }, {\n        id: this.generateId(),\n        type: 'ellipse',\n        x: baseX + 220,\n        y: baseY,\n        width: 140,\n        height: 90,\n        strokeColor: '#388e3c',\n        fillColor: '#E8F5E9',\n        strokeWidth: 2,\n        rotation: 0,\n        text: 'Decisão'\n      }, {\n        id: this.generateId(),\n        type: 'arrow',\n        x: baseX + 160,\n        y: baseY + 45,\n        width: 60,\n        height: 0,\n        strokeColor: '#444',\n        fillColor: '#444',\n        strokeWidth: 3,\n        rotation: 0\n      }];\n    }\n    const currentMaxZ = this.elements.length ? Math.max(...this.elements.map(el => el.zIndex ?? 0)) : 0;\n    const withZ = elements.map((el, idx) => ({\n      ...el,\n      zIndex: currentMaxZ + idx + 1\n    }));\n    this.elementsSubject.next([...this.elements, ...withZ]);\n  }\n  setTheme(theme) {\n    this.themeSubject.next(theme);\n    this.applyTheme(theme);\n  }\n  clear() {\n    this.elementsSubject.next([]);\n    this.zoomSubject.next(1);\n    this.panSubject.next({\n      x: 0,\n      y: 0\n    });\n    this.snapToGridSubject.next(false);\n    this.gridSizeSubject.next(20);\n    this.themeSubject.next('light');\n  }\n  getState() {\n    return {\n      elements: [...this.elements],\n      zoom: this.zoom,\n      panX: this.pan.x,\n      panY: this.pan.y,\n      snapToGrid: this.snapToGrid,\n      gridSize: this.gridSize\n    };\n  }\n  setState(state) {\n    this.elementsSubject.next([...state.elements]);\n    this.zoomSubject.next(state.zoom);\n    this.panSubject.next({\n      x: state.panX,\n      y: state.panY\n    });\n    this.snapToGridSubject.next(!!state.snapToGrid);\n    this.gridSizeSubject.next(state.gridSize ?? 20);\n  }\n  exportToJSON() {\n    return JSON.stringify(this.getState(), null, 2);\n  }\n  importFromJSON(json) {\n    try {\n      const state = JSON.parse(json);\n      this.setState(state);\n      return true;\n    } catch {\n      return false;\n    }\n  }\n  generateId() {\n    return `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n  }\n  getBounds(elements) {\n    const xs = elements.map(el => [el.x, el.x + (el.width || 0)]).flat();\n    const ys = elements.map(el => [el.y, el.y + (el.height || 0)]).flat();\n    const minX = Math.min(...xs);\n    const maxX = Math.max(...xs);\n    const minY = Math.min(...ys);\n    const maxY = Math.max(...ys);\n    return {\n      minX,\n      maxX,\n      minY,\n      maxY,\n      width: maxX - minX,\n      height: maxY - minY\n    };\n  }\n  normalizeZIndices() {\n    const sorted = this.sortByZIndex(this.elements);\n    const normalized = sorted.map((el, idx) => ({\n      ...el,\n      zIndex: idx\n    }));\n    this.elementsSubject.next(normalized);\n  }\n  sortByZIndex(elements) {\n    return [...elements].sort((a, b) => (a.zIndex ?? 0) - (b.zIndex ?? 0));\n  }\n  applyTheme(theme) {\n    const body = document.body;\n    body.classList.remove('theme-light', 'theme-dark');\n    body.classList.add(`theme-${theme}`);\n  }\n  setupBroadcast() {\n    if (typeof BroadcastChannel === 'undefined') return;\n    this.broadcastChannel = new BroadcastChannel('whiteboard-sync');\n    this.broadcastChannel.onmessage = event => {\n      const {\n        origin,\n        state\n      } = event.data || {};\n      if (!state || origin === this.instanceId) return;\n      this.isApplyingRemote = true;\n      this.setState(state);\n      this.isApplyingRemote = false;\n    };\n    combineLatest([this.elements$, this.zoom$, this.pan$, this.snapToGrid$, this.gridSize$]).subscribe(([elements, zoom, pan, snap, grid]) => {\n      if (!this.broadcastChannel || this.isApplyingRemote) return;\n      const state = {\n        elements,\n        zoom,\n        panX: pan.x,\n        panY: pan.y,\n        snapToGrid: snap,\n        gridSize: grid\n      };\n      this.broadcastChannel.postMessage({\n        origin: this.instanceId,\n        state\n      });\n    });\n  }\n  static {\n    this.ɵfac = function CanvasService_Factory(t) {\n      return new (t || CanvasService)();\n    };\n  }\n  static {\n    this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: CanvasService,\n      factory: CanvasService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n}","map":{"version":3,"names":["BehaviorSubject","combineLatest","CanvasService","constructor","elementsSubject","zoomSubject","panSubject","x","y","snapToGridSubject","gridSizeSubject","themeSubject","isApplyingRemote","instanceId","Date","now","Math","random","toString","slice","elements$","asObservable","zoom$","pan$","snapToGrid$","gridSize$","theme$","setupBroadcast","applyTheme","value","elements","zoom","pan","snapToGrid","gridSize","theme","addElement","element","zIndex","length","max","map","e","next","updateElement","id","updates","el","updateSelectedTextStyle","style","isSelected","text","fontSize","fontFamily","fontWeight","fontStyle","strokeColor","updateSelectedDimensions","dimensions","width","height","setElements","deleteElement","filter","deleteSelectedElements","normalizeZIndices","clearSelection","selectElement","addToSelection","setZoom","min","setPan","setSnapToGrid","enabled","setGridSize","size","clamped","rotateSelected","deltaDeg","rotation","alignSelected","alignment","selected","bounds","getBounds","updated","w","h","minX","maxX","minY","maxY","distributeSelected","orientation","sort","a","b","gaps","totalWidth","reduce","sum","abs","space","cursor","updatedIds","Set","s","has","totalHeight","groupSelected","groupId","ungroupSelected","undefined","bringToFront","selectedIds","reordered","idx","bumped","sortByZIndex","sendToBack","insertTemplate","name","baseX","baseY","palette","color","generateId","type","fillColor","strokeWidth","currentMaxZ","withZ","setTheme","clear","getState","panX","panY","setState","state","exportToJSON","JSON","stringify","importFromJSON","json","parse","substr","xs","flat","ys","sorted","normalized","body","document","classList","remove","add","BroadcastChannel","broadcastChannel","onmessage","event","origin","data","subscribe","snap","grid","postMessage","factory","ɵfac","providedIn"],"sources":["C:\\Users\\vinic\\Desktop\\Estagio\\Teste\\src\\app\\services\\canvas.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\r\nimport { BehaviorSubject, Observable, combineLatest } from 'rxjs';\r\nimport { CanvasState, DrawingElement, Point } from '../models/drawing.model';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class CanvasService {\r\n  private elementsSubject = new BehaviorSubject<DrawingElement[]>([]);\r\n  private zoomSubject = new BehaviorSubject<number>(1);\r\n  private panSubject = new BehaviorSubject<Point>({ x: 0, y: 0 });\r\n  private snapToGridSubject = new BehaviorSubject<boolean>(false);\r\n  private gridSizeSubject = new BehaviorSubject<number>(20);\r\n  private themeSubject = new BehaviorSubject<'light' | 'dark'>('light');\r\n\r\n  private broadcastChannel?: BroadcastChannel;\r\n  private isApplyingRemote = false;\r\n  private instanceId = `${Date.now()}-${Math.random().toString(36).slice(2)}`;\r\n\r\n  elements$: Observable<DrawingElement[]> = this.elementsSubject.asObservable();\r\n  zoom$: Observable<number> = this.zoomSubject.asObservable();\r\n  pan$: Observable<Point> = this.panSubject.asObservable();\r\n  snapToGrid$: Observable<boolean> = this.snapToGridSubject.asObservable();\r\n  gridSize$: Observable<number> = this.gridSizeSubject.asObservable();\r\n  theme$: Observable<'light' | 'dark'> = this.themeSubject.asObservable();\r\n\r\n  constructor() {\r\n    this.setupBroadcast();\r\n    this.applyTheme(this.themeSubject.value);\r\n  }\r\n\r\n  get elements(): DrawingElement[] {\r\n    return this.elementsSubject.value;\r\n  }\r\n\r\n  get zoom(): number {\r\n    return this.zoomSubject.value;\r\n  }\r\n\r\n  get pan(): Point {\r\n    return this.panSubject.value;\r\n  }\r\n\r\n  get snapToGrid(): boolean {\r\n    return this.snapToGridSubject.value;\r\n  }\r\n\r\n  get gridSize(): number {\r\n    return this.gridSizeSubject.value;\r\n  }\r\n\r\n  get theme(): 'light' | 'dark' {\r\n    return this.themeSubject.value;\r\n  }\r\n\r\n  addElement(element: DrawingElement): void {\r\n    const zIndex = element.zIndex ?? (this.elements.length ? Math.max(...this.elements.map(e => e.zIndex ?? 0)) + 1 : 0);\r\n    const elements = [...this.elements, { ...element, zIndex }];\r\n    this.elementsSubject.next(elements);\r\n  }\r\n\r\n  updateElement(id: string, updates: Partial<DrawingElement>): void {\r\n    const elements = this.elements.map(el =>\r\n      el.id === id ? { ...el, ...updates } : el\r\n    );\r\n    this.elementsSubject.next(elements);\r\n  }\r\n\r\n  updateSelectedTextStyle(style: {\r\n    fontSize?: number;\r\n    fontFamily?: string;\r\n    fontWeight?: 'normal' | 'bold';\r\n    fontStyle?: 'normal' | 'italic';\r\n    strokeColor?: string;\r\n  }): void {\r\n    const elements = this.elements.map(el => {\r\n      if (!el.isSelected || !el.text) return el;\r\n      return {\r\n        ...el,\r\n        fontSize: style.fontSize ?? el.fontSize,\r\n        fontFamily: style.fontFamily ?? el.fontFamily,\r\n        fontWeight: style.fontWeight ?? el.fontWeight,\r\n        fontStyle: style.fontStyle ?? el.fontStyle,\r\n        strokeColor: style.strokeColor ?? el.strokeColor\r\n      };\r\n    });\r\n    this.elementsSubject.next(elements);\r\n  }\r\n\r\n  updateSelectedDimensions(dimensions: { width?: number; height?: number }): void {\r\n    const elements = this.elements.map(el => {\r\n      if (!el.isSelected) return el;\r\n      return {\r\n        ...el,\r\n        width: dimensions.width ?? el.width,\r\n        height: dimensions.height ?? el.height\r\n      };\r\n    });\r\n    this.elementsSubject.next(elements);\r\n  }\r\n\r\n  setElements(elements: DrawingElement[]): void {\r\n    this.elementsSubject.next(elements);\r\n  }\r\n\r\n  deleteElement(id: string): void {\r\n    const elements = this.elements.filter(el => el.id !== id);\r\n    this.elementsSubject.next(elements);\r\n  }\r\n\r\n  deleteSelectedElements(): void {\r\n    const elements = this.elements.filter(el => !el.isSelected);\r\n    this.elementsSubject.next(elements);\r\n    this.normalizeZIndices();\r\n  }\r\n\r\n  clearSelection(): void {\r\n    const elements = this.elements.map(el => ({ ...el, isSelected: false }));\r\n    this.elementsSubject.next(elements);\r\n  }\r\n\r\n  selectElement(id: string, addToSelection = false): void {\r\n    const elements = this.elements.map(el => ({\r\n      ...el,\r\n      isSelected: el.id === id ? true : (addToSelection ? el.isSelected : false)\r\n    }));\r\n    this.elementsSubject.next(elements);\r\n  }\r\n\r\n  setZoom(zoom: number): void {\r\n    this.zoomSubject.next(Math.max(0.1, Math.min(5, zoom)));\r\n  }\r\n\r\n  setPan(pan: Point): void {\r\n    this.panSubject.next(pan);\r\n  }\r\n\r\n  setSnapToGrid(enabled: boolean): void {\r\n    this.snapToGridSubject.next(enabled);\r\n  }\r\n\r\n  setGridSize(size: number): void {\r\n    const clamped = Math.max(5, Math.min(200, size));\r\n    this.gridSizeSubject.next(clamped);\r\n  }\r\n\r\n  rotateSelected(deltaDeg: number): void {\r\n    const elements = this.elements.map(el =>\r\n      el.isSelected ? { ...el, rotation: (el.rotation + deltaDeg) % 360 } : el\r\n    );\r\n    this.elementsSubject.next(elements);\r\n  }\r\n\r\n  alignSelected(alignment: 'left' | 'right' | 'top' | 'bottom' | 'center' | 'middle'): void {\r\n    const selected = this.elements.filter(el => el.isSelected);\r\n    if (selected.length < 2) return;\r\n\r\n    const bounds = this.getBounds(selected);\r\n    const updated = this.elements.map(el => {\r\n      if (!el.isSelected) return el;\r\n      const w = el.width || 0;\r\n      const h = el.height || 0;\r\n      switch (alignment) {\r\n        case 'left':\r\n          return { ...el, x: bounds.minX };\r\n        case 'right':\r\n          return { ...el, x: bounds.maxX - w };\r\n        case 'top':\r\n          return { ...el, y: bounds.minY };\r\n        case 'bottom':\r\n          return { ...el, y: bounds.maxY - h };\r\n        case 'center':\r\n          return { ...el, x: bounds.minX + (bounds.width - w) / 2 };\r\n        case 'middle':\r\n          return { ...el, y: bounds.minY + (bounds.height - h) / 2 };\r\n      }\r\n    });\r\n\r\n    this.elementsSubject.next(updated);\r\n  }\r\n\r\n  distributeSelected(orientation: 'horizontal' | 'vertical'): void {\r\n    const selected = this.elements\r\n      .filter(el => el.isSelected)\r\n      .sort((a, b) => (orientation === 'horizontal' ? a.x - b.x : a.y - b.y));\r\n    if (selected.length < 3) return;\r\n\r\n    const bounds = this.getBounds(selected);\r\n    const gaps = selected.length - 1;\r\n    if (orientation === 'horizontal') {\r\n      const totalWidth = selected.reduce((sum, el) => sum + Math.abs(el.width || 0), 0);\r\n      const space = bounds.width - totalWidth;\r\n      let cursor = bounds.minX;\r\n      const updatedIds = new Set(selected.map(s => s.id));\r\n      const updated = this.elements.map(el => {\r\n        if (!updatedIds.has(el.id)) return el;\r\n        const w = Math.abs(el.width || 0);\r\n        const next = { ...el, x: cursor };\r\n        cursor += w + space / gaps;\r\n        return next;\r\n      });\r\n      this.elementsSubject.next(updated);\r\n    } else {\r\n      const totalHeight = selected.reduce((sum, el) => sum + Math.abs(el.height || 0), 0);\r\n      const space = bounds.height - totalHeight;\r\n      let cursor = bounds.minY;\r\n      const updatedIds = new Set(selected.map(s => s.id));\r\n      const updated = this.elements.map(el => {\r\n        if (!updatedIds.has(el.id)) return el;\r\n        const h = Math.abs(el.height || 0);\r\n        const next = { ...el, y: cursor };\r\n        cursor += h + space / gaps;\r\n        return next;\r\n      });\r\n      this.elementsSubject.next(updated);\r\n    }\r\n  }\r\n\r\n  groupSelected(): void {\r\n    const selected = this.elements.filter(el => el.isSelected);\r\n    if (selected.length < 2) return;\r\n    const groupId = `group-${Date.now()}-${Math.random().toString(36).slice(2)}`;\r\n    const elements = this.elements.map(el => (el.isSelected ? { ...el, groupId } : el));\r\n    this.elementsSubject.next(elements);\r\n  }\r\n\r\n  ungroupSelected(): void {\r\n    const elements = this.elements.map(el => (el.isSelected ? { ...el, groupId: undefined } : el));\r\n    this.elementsSubject.next(elements);\r\n  }\r\n\r\n  bringToFront(): void {\r\n    const selectedIds = new Set(this.elements.filter(el => el.isSelected).map(el => el.id));\r\n    if (!selectedIds.size) return;\r\n    const reordered = [...this.elements]\r\n      .sort((a, b) => (a.zIndex ?? 0) - (b.zIndex ?? 0))\r\n      .map((el, idx) => ({ ...el, zIndex: idx }));\r\n\r\n    const max = reordered.length - 1;\r\n    const bumped = reordered.map(el => (selectedIds.has(el.id) ? { ...el, zIndex: max + 1 } : el));\r\n    this.elementsSubject.next(this.sortByZIndex(bumped));\r\n    this.normalizeZIndices();\r\n  }\r\n\r\n  sendToBack(): void {\r\n    const selectedIds = new Set(this.elements.filter(el => el.isSelected).map(el => el.id));\r\n    if (!selectedIds.size) return;\r\n    const reordered = [...this.elements]\r\n      .sort((a, b) => (a.zIndex ?? 0) - (b.zIndex ?? 0))\r\n      .map((el, idx) => ({ ...el, zIndex: idx }));\r\n\r\n    const bumped = reordered.map(el => (selectedIds.has(el.id) ? { ...el, zIndex: -1 } : el));\r\n    this.elementsSubject.next(this.sortByZIndex(bumped));\r\n    this.normalizeZIndices();\r\n  }\r\n\r\n  insertTemplate(name: 'sticky-notes' | 'flow'): void {\r\n    const baseX = 50;\r\n    const baseY = 80;\r\n    const palette = ['#FFEB3B', '#FFCDD2', '#C5E1A5', '#BBDEFB'];\r\n    let elements: DrawingElement[] = [];\r\n\r\n    if (name === 'sticky-notes') {\r\n      elements = palette.map((color, idx) => ({\r\n        id: this.generateId(),\r\n        type: 'rectangle',\r\n        x: baseX + idx * 140,\r\n        y: baseY,\r\n        width: 120,\r\n        height: 120,\r\n        strokeColor: '#444',\r\n        fillColor: color,\r\n        strokeWidth: 2,\r\n        rotation: 0,\r\n        text: 'Nota'\r\n      }));\r\n    } else {\r\n      elements = [\r\n        {\r\n          id: this.generateId(),\r\n          type: 'rectangle',\r\n          x: baseX,\r\n          y: baseY,\r\n          width: 160,\r\n          height: 90,\r\n          strokeColor: '#1976d2',\r\n          fillColor: '#E3F2FD',\r\n          strokeWidth: 2,\r\n          rotation: 0,\r\n          text: 'Início'\r\n        },\r\n        {\r\n          id: this.generateId(),\r\n          type: 'ellipse',\r\n          x: baseX + 220,\r\n          y: baseY,\r\n          width: 140,\r\n          height: 90,\r\n          strokeColor: '#388e3c',\r\n          fillColor: '#E8F5E9',\r\n          strokeWidth: 2,\r\n          rotation: 0,\r\n          text: 'Decisão'\r\n        },\r\n        {\r\n          id: this.generateId(),\r\n          type: 'arrow',\r\n          x: baseX + 160,\r\n          y: baseY + 45,\r\n          width: 60,\r\n          height: 0,\r\n          strokeColor: '#444',\r\n          fillColor: '#444',\r\n          strokeWidth: 3,\r\n          rotation: 0\r\n        }\r\n      ];\r\n    }\r\n\r\n    const currentMaxZ = this.elements.length ? Math.max(...this.elements.map(el => el.zIndex ?? 0)) : 0;\r\n    const withZ = elements.map((el, idx) => ({ ...el, zIndex: currentMaxZ + idx + 1 }));\r\n    this.elementsSubject.next([...this.elements, ...withZ]);\r\n  }\r\n\r\n  setTheme(theme: 'light' | 'dark'): void {\r\n    this.themeSubject.next(theme);\r\n    this.applyTheme(theme);\r\n  }\r\n\r\n  clear(): void {\r\n    this.elementsSubject.next([]);\r\n    this.zoomSubject.next(1);\r\n    this.panSubject.next({ x: 0, y: 0 });\r\n    this.snapToGridSubject.next(false);\r\n    this.gridSizeSubject.next(20);\r\n    this.themeSubject.next('light');\r\n  }\r\n\r\n  getState(): CanvasState {\r\n    return {\r\n      elements: [...this.elements],\r\n      zoom: this.zoom,\r\n      panX: this.pan.x,\r\n      panY: this.pan.y,\r\n      snapToGrid: this.snapToGrid,\r\n      gridSize: this.gridSize\r\n    };\r\n  }\r\n\r\n  setState(state: CanvasState): void {\r\n    this.elementsSubject.next([...state.elements]);\r\n    this.zoomSubject.next(state.zoom);\r\n    this.panSubject.next({ x: state.panX, y: state.panY });\r\n    this.snapToGridSubject.next(!!state.snapToGrid);\r\n    this.gridSizeSubject.next(state.gridSize ?? 20);\r\n  }\r\n\r\n  exportToJSON(): string {\r\n    return JSON.stringify(this.getState(), null, 2);\r\n  }\r\n\r\n  importFromJSON(json: string): boolean {\r\n    try {\r\n      const state = JSON.parse(json);\r\n      this.setState(state);\r\n      return true;\r\n    } catch {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  generateId(): string {\r\n    return `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\r\n  }\r\n\r\n  private getBounds(elements: DrawingElement[]) {\r\n    const xs = elements.map(el => [el.x, el.x + (el.width || 0)]).flat();\r\n    const ys = elements.map(el => [el.y, el.y + (el.height || 0)]).flat();\r\n    const minX = Math.min(...xs);\r\n    const maxX = Math.max(...xs);\r\n    const minY = Math.min(...ys);\r\n    const maxY = Math.max(...ys);\r\n    return { minX, maxX, minY, maxY, width: maxX - minX, height: maxY - minY };\r\n  }\r\n\r\n  private normalizeZIndices(): void {\r\n    const sorted = this.sortByZIndex(this.elements);\r\n    const normalized = sorted.map((el, idx) => ({ ...el, zIndex: idx }));\r\n    this.elementsSubject.next(normalized);\r\n  }\r\n\r\n  private sortByZIndex(elements: DrawingElement[]): DrawingElement[] {\r\n    return [...elements].sort((a, b) => (a.zIndex ?? 0) - (b.zIndex ?? 0));\r\n  }\r\n\r\n  private applyTheme(theme: 'light' | 'dark'): void {\r\n    const body = document.body;\r\n    body.classList.remove('theme-light', 'theme-dark');\r\n    body.classList.add(`theme-${theme}`);\r\n  }\r\n\r\n  private setupBroadcast(): void {\r\n    if (typeof BroadcastChannel === 'undefined') return;\r\n    this.broadcastChannel = new BroadcastChannel('whiteboard-sync');\r\n\r\n    this.broadcastChannel.onmessage = (event: MessageEvent) => {\r\n      const { origin, state } = event.data || {};\r\n      if (!state || origin === this.instanceId) return;\r\n      this.isApplyingRemote = true;\r\n      this.setState(state);\r\n      this.isApplyingRemote = false;\r\n    };\r\n\r\n    combineLatest([this.elements$, this.zoom$, this.pan$, this.snapToGrid$, this.gridSize$]).subscribe(([elements, zoom, pan, snap, grid]) => {\r\n      if (!this.broadcastChannel || this.isApplyingRemote) return;\r\n      const state: CanvasState = { elements, zoom, panX: pan.x, panY: pan.y, snapToGrid: snap, gridSize: grid };\r\n      this.broadcastChannel.postMessage({ origin: this.instanceId, state });\r\n    });\r\n  }\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}