{"ast":null,"code":"import { BehaviorSubject, combineLatest } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nexport class CanvasService {\n  constructor() {\n    this.elementsSubject = new BehaviorSubject([]);\n    this.zoomSubject = new BehaviorSubject(1);\n    this.panSubject = new BehaviorSubject({\n      x: 0,\n      y: 0\n    });\n    this.snapToGridSubject = new BehaviorSubject(false);\n    this.gridSizeSubject = new BehaviorSubject(20);\n    this.themeSubject = new BehaviorSubject('light');\n    this.isApplyingRemote = false;\n    this.instanceId = `${Date.now()}-${Math.random().toString(36).slice(2)}`;\n    this.elements$ = this.elementsSubject.asObservable();\n    this.zoom$ = this.zoomSubject.asObservable();\n    this.pan$ = this.panSubject.asObservable();\n    this.snapToGrid$ = this.snapToGridSubject.asObservable();\n    this.gridSize$ = this.gridSizeSubject.asObservable();\n    this.theme$ = this.themeSubject.asObservable();\n    this.setupBroadcast();\n    this.applyTheme(this.themeSubject.value);\n  }\n  get elements() {\n    return this.elementsSubject.value;\n  }\n  get zoom() {\n    return this.zoomSubject.value;\n  }\n  get pan() {\n    return this.panSubject.value;\n  }\n  get snapToGrid() {\n    return this.snapToGridSubject.value;\n  }\n  get gridSize() {\n    return this.gridSizeSubject.value;\n  }\n  get theme() {\n    return this.themeSubject.value;\n  }\n  addElement(element) {\n    const zIndex = element.zIndex ?? (this.elements.length ? Math.max(...this.elements.map(e => e.zIndex ?? 0)) + 1 : 0);\n    const elements = [...this.elements, {\n      ...element,\n      zIndex\n    }];\n    this.elementsSubject.next(elements);\n  }\n  updateElement(id, updates) {\n    const elements = this.elements.map(el => el.id === id ? {\n      ...el,\n      ...updates\n    } : el);\n    this.elementsSubject.next(elements);\n  }\n  setElements(elements) {\n    this.elementsSubject.next(elements);\n  }\n  deleteElement(id) {\n    const elements = this.elements.filter(el => el.id !== id);\n    this.elementsSubject.next(elements);\n  }\n  deleteSelectedElements() {\n    const elements = this.elements.filter(el => !el.isSelected);\n    this.elementsSubject.next(elements);\n    this.normalizeZIndices();\n  }\n  clearSelection() {\n    const elements = this.elements.map(el => ({\n      ...el,\n      isSelected: false\n    }));\n    this.elementsSubject.next(elements);\n  }\n  selectElement(id, addToSelection = false) {\n    const elements = this.elements.map(el => ({\n      ...el,\n      isSelected: el.id === id ? true : addToSelection ? el.isSelected : false\n    }));\n    this.elementsSubject.next(elements);\n  }\n  setZoom(zoom) {\n    this.zoomSubject.next(Math.max(0.1, Math.min(5, zoom)));\n  }\n  setPan(pan) {\n    this.panSubject.next(pan);\n  }\n  setSnapToGrid(enabled) {\n    this.snapToGridSubject.next(enabled);\n  }\n  setGridSize(size) {\n    const clamped = Math.max(5, Math.min(200, size));\n    this.gridSizeSubject.next(clamped);\n  }\n  rotateSelected(deltaDeg) {\n    const elements = this.elements.map(el => el.isSelected ? {\n      ...el,\n      rotation: (el.rotation + deltaDeg) % 360\n    } : el);\n    this.elementsSubject.next(elements);\n  }\n  alignSelected(alignment) {\n    const selected = this.elements.filter(el => el.isSelected);\n    if (selected.length < 2) return;\n    const bounds = this.getBounds(selected);\n    const updated = this.elements.map(el => {\n      if (!el.isSelected) return el;\n      const w = el.width || 0;\n      const h = el.height || 0;\n      switch (alignment) {\n        case 'left':\n          return {\n            ...el,\n            x: bounds.minX\n          };\n        case 'right':\n          return {\n            ...el,\n            x: bounds.maxX - w\n          };\n        case 'top':\n          return {\n            ...el,\n            y: bounds.minY\n          };\n        case 'bottom':\n          return {\n            ...el,\n            y: bounds.maxY - h\n          };\n        case 'center':\n          return {\n            ...el,\n            x: bounds.minX + (bounds.width - w) / 2\n          };\n        case 'middle':\n          return {\n            ...el,\n            y: bounds.minY + (bounds.height - h) / 2\n          };\n      }\n    });\n    this.elementsSubject.next(updated);\n  }\n  distributeSelected(orientation) {\n    const selected = this.elements.filter(el => el.isSelected).sort((a, b) => orientation === 'horizontal' ? a.x - b.x : a.y - b.y);\n    if (selected.length < 3) return;\n    const bounds = this.getBounds(selected);\n    const gaps = selected.length - 1;\n    if (orientation === 'horizontal') {\n      const totalWidth = selected.reduce((sum, el) => sum + Math.abs(el.width || 0), 0);\n      const space = bounds.width - totalWidth;\n      let cursor = bounds.minX;\n      const updatedIds = new Set(selected.map(s => s.id));\n      const updated = this.elements.map(el => {\n        if (!updatedIds.has(el.id)) return el;\n        const w = Math.abs(el.width || 0);\n        const next = {\n          ...el,\n          x: cursor\n        };\n        cursor += w + space / gaps;\n        return next;\n      });\n      this.elementsSubject.next(updated);\n    } else {\n      const totalHeight = selected.reduce((sum, el) => sum + Math.abs(el.height || 0), 0);\n      const space = bounds.height - totalHeight;\n      let cursor = bounds.minY;\n      const updatedIds = new Set(selected.map(s => s.id));\n      const updated = this.elements.map(el => {\n        if (!updatedIds.has(el.id)) return el;\n        const h = Math.abs(el.height || 0);\n        const next = {\n          ...el,\n          y: cursor\n        };\n        cursor += h + space / gaps;\n        return next;\n      });\n      this.elementsSubject.next(updated);\n    }\n  }\n  groupSelected() {\n    const selected = this.elements.filter(el => el.isSelected);\n    if (selected.length < 2) return;\n    const groupId = `group-${Date.now()}-${Math.random().toString(36).slice(2)}`;\n    const elements = this.elements.map(el => el.isSelected ? {\n      ...el,\n      groupId\n    } : el);\n    this.elementsSubject.next(elements);\n  }\n  ungroupSelected() {\n    const elements = this.elements.map(el => el.isSelected ? {\n      ...el,\n      groupId: undefined\n    } : el);\n    this.elementsSubject.next(elements);\n  }\n  bringToFront() {\n    const selectedIds = new Set(this.elements.filter(el => el.isSelected).map(el => el.id));\n    if (!selectedIds.size) return;\n    const reordered = [...this.elements].sort((a, b) => (a.zIndex ?? 0) - (b.zIndex ?? 0)).map((el, idx) => ({\n      ...el,\n      zIndex: idx\n    }));\n    const max = reordered.length - 1;\n    const bumped = reordered.map(el => selectedIds.has(el.id) ? {\n      ...el,\n      zIndex: max + 1\n    } : el);\n    this.elementsSubject.next(this.sortByZIndex(bumped));\n    this.normalizeZIndices();\n  }\n  sendToBack() {\n    const selectedIds = new Set(this.elements.filter(el => el.isSelected).map(el => el.id));\n    if (!selectedIds.size) return;\n    const reordered = [...this.elements].sort((a, b) => (a.zIndex ?? 0) - (b.zIndex ?? 0)).map((el, idx) => ({\n      ...el,\n      zIndex: idx\n    }));\n    const bumped = reordered.map(el => selectedIds.has(el.id) ? {\n      ...el,\n      zIndex: -1\n    } : el);\n    this.elementsSubject.next(this.sortByZIndex(bumped));\n    this.normalizeZIndices();\n  }\n  insertTemplate(name) {\n    const baseX = 50;\n    const baseY = 80;\n    const palette = ['#FFEB3B', '#FFCDD2', '#C5E1A5', '#BBDEFB'];\n    let elements = [];\n    if (name === 'sticky-notes') {\n      elements = palette.map((color, idx) => ({\n        id: this.generateId(),\n        type: 'rectangle',\n        x: baseX + idx * 140,\n        y: baseY,\n        width: 120,\n        height: 120,\n        strokeColor: '#444',\n        fillColor: color,\n        strokeWidth: 2,\n        rotation: 0,\n        text: 'Nota'\n      }));\n    } else {\n      elements = [{\n        id: this.generateId(),\n        type: 'rectangle',\n        x: baseX,\n        y: baseY,\n        width: 160,\n        height: 90,\n        strokeColor: '#1976d2',\n        fillColor: '#E3F2FD',\n        strokeWidth: 2,\n        rotation: 0,\n        text: 'Início'\n      }, {\n        id: this.generateId(),\n        type: 'ellipse',\n        x: baseX + 220,\n        y: baseY,\n        width: 140,\n        height: 90,\n        strokeColor: '#388e3c',\n        fillColor: '#E8F5E9',\n        strokeWidth: 2,\n        rotation: 0,\n        text: 'Decisão'\n      }, {\n        id: this.generateId(),\n        type: 'arrow',\n        x: baseX + 160,\n        y: baseY + 45,\n        width: 60,\n        height: 0,\n        strokeColor: '#444',\n        fillColor: '#444',\n        strokeWidth: 3,\n        rotation: 0\n      }];\n    }\n    const currentMaxZ = this.elements.length ? Math.max(...this.elements.map(el => el.zIndex ?? 0)) : 0;\n    const withZ = elements.map((el, idx) => ({\n      ...el,\n      zIndex: currentMaxZ + idx + 1\n    }));\n    this.elementsSubject.next([...this.elements, ...withZ]);\n  }\n  setTheme(theme) {\n    this.themeSubject.next(theme);\n    this.applyTheme(theme);\n  }\n  clear() {\n    this.elementsSubject.next([]);\n    this.zoomSubject.next(1);\n    this.panSubject.next({\n      x: 0,\n      y: 0\n    });\n    this.snapToGridSubject.next(false);\n    this.gridSizeSubject.next(20);\n    this.themeSubject.next('light');\n  }\n  getState() {\n    return {\n      elements: [...this.elements],\n      zoom: this.zoom,\n      panX: this.pan.x,\n      panY: this.pan.y,\n      snapToGrid: this.snapToGrid,\n      gridSize: this.gridSize\n    };\n  }\n  setState(state) {\n    this.elementsSubject.next([...state.elements]);\n    this.zoomSubject.next(state.zoom);\n    this.panSubject.next({\n      x: state.panX,\n      y: state.panY\n    });\n    this.snapToGridSubject.next(!!state.snapToGrid);\n    this.gridSizeSubject.next(state.gridSize ?? 20);\n  }\n  exportToJSON() {\n    return JSON.stringify(this.getState(), null, 2);\n  }\n  importFromJSON(json) {\n    try {\n      const state = JSON.parse(json);\n      this.setState(state);\n      return true;\n    } catch {\n      return false;\n    }\n  }\n  generateId() {\n    return `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n  }\n  getBounds(elements) {\n    const xs = elements.map(el => [el.x, el.x + (el.width || 0)]).flat();\n    const ys = elements.map(el => [el.y, el.y + (el.height || 0)]).flat();\n    const minX = Math.min(...xs);\n    const maxX = Math.max(...xs);\n    const minY = Math.min(...ys);\n    const maxY = Math.max(...ys);\n    return {\n      minX,\n      maxX,\n      minY,\n      maxY,\n      width: maxX - minX,\n      height: maxY - minY\n    };\n  }\n  normalizeZIndices() {\n    const sorted = this.sortByZIndex(this.elements);\n    const normalized = sorted.map((el, idx) => ({\n      ...el,\n      zIndex: idx\n    }));\n    this.elementsSubject.next(normalized);\n  }\n  sortByZIndex(elements) {\n    return [...elements].sort((a, b) => (a.zIndex ?? 0) - (b.zIndex ?? 0));\n  }\n  applyTheme(theme) {\n    const body = document.body;\n    body.classList.remove('theme-light', 'theme-dark');\n    body.classList.add(`theme-${theme}`);\n  }\n  setupBroadcast() {\n    if (typeof BroadcastChannel === 'undefined') return;\n    this.broadcastChannel = new BroadcastChannel('whiteboard-sync');\n    this.broadcastChannel.onmessage = event => {\n      const {\n        origin,\n        state\n      } = event.data || {};\n      if (!state || origin === this.instanceId) return;\n      this.isApplyingRemote = true;\n      this.setState(state);\n      this.isApplyingRemote = false;\n    };\n    combineLatest([this.elements$, this.zoom$, this.pan$, this.snapToGrid$, this.gridSize$]).subscribe(([elements, zoom, pan, snap, grid]) => {\n      if (!this.broadcastChannel || this.isApplyingRemote) return;\n      const state = {\n        elements,\n        zoom,\n        panX: pan.x,\n        panY: pan.y,\n        snapToGrid: snap,\n        gridSize: grid\n      };\n      this.broadcastChannel.postMessage({\n        origin: this.instanceId,\n        state\n      });\n    });\n  }\n  static {\n    this.ɵfac = function CanvasService_Factory(t) {\n      return new (t || CanvasService)();\n    };\n  }\n  static {\n    this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: CanvasService,\n      factory: CanvasService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n}","map":{"version":3,"names":["BehaviorSubject","combineLatest","CanvasService","constructor","elementsSubject","zoomSubject","panSubject","x","y","snapToGridSubject","gridSizeSubject","themeSubject","isApplyingRemote","instanceId","Date","now","Math","random","toString","slice","elements$","asObservable","zoom$","pan$","snapToGrid$","gridSize$","theme$","setupBroadcast","applyTheme","value","elements","zoom","pan","snapToGrid","gridSize","theme","addElement","element","zIndex","length","max","map","e","next","updateElement","id","updates","el","setElements","deleteElement","filter","deleteSelectedElements","isSelected","normalizeZIndices","clearSelection","selectElement","addToSelection","setZoom","min","setPan","setSnapToGrid","enabled","setGridSize","size","clamped","rotateSelected","deltaDeg","rotation","alignSelected","alignment","selected","bounds","getBounds","updated","w","width","h","height","minX","maxX","minY","maxY","distributeSelected","orientation","sort","a","b","gaps","totalWidth","reduce","sum","abs","space","cursor","updatedIds","Set","s","has","totalHeight","groupSelected","groupId","ungroupSelected","undefined","bringToFront","selectedIds","reordered","idx","bumped","sortByZIndex","sendToBack","insertTemplate","name","baseX","baseY","palette","color","generateId","type","strokeColor","fillColor","strokeWidth","text","currentMaxZ","withZ","setTheme","clear","getState","panX","panY","setState","state","exportToJSON","JSON","stringify","importFromJSON","json","parse","substr","xs","flat","ys","sorted","normalized","body","document","classList","remove","add","BroadcastChannel","broadcastChannel","onmessage","event","origin","data","subscribe","snap","grid","postMessage","factory","ɵfac","providedIn"],"sources":["C:\\Users\\vinic\\Desktop\\Estagio\\Teste\\src\\app\\services\\canvas.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\r\nimport { BehaviorSubject, Observable, combineLatest } from 'rxjs';\r\nimport { CanvasState, DrawingElement, Point } from '../models/drawing.model';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class CanvasService {\r\n  private elementsSubject = new BehaviorSubject<DrawingElement[]>([]);\r\n  private zoomSubject = new BehaviorSubject<number>(1);\r\n  private panSubject = new BehaviorSubject<Point>({ x: 0, y: 0 });\r\n  private snapToGridSubject = new BehaviorSubject<boolean>(false);\r\n  private gridSizeSubject = new BehaviorSubject<number>(20);\r\n  private themeSubject = new BehaviorSubject<'light' | 'dark'>('light');\r\n\r\n  private broadcastChannel?: BroadcastChannel;\r\n  private isApplyingRemote = false;\r\n  private instanceId = `${Date.now()}-${Math.random().toString(36).slice(2)}`;\r\n\r\n  elements$: Observable<DrawingElement[]> = this.elementsSubject.asObservable();\r\n  zoom$: Observable<number> = this.zoomSubject.asObservable();\r\n  pan$: Observable<Point> = this.panSubject.asObservable();\r\n  snapToGrid$: Observable<boolean> = this.snapToGridSubject.asObservable();\r\n  gridSize$: Observable<number> = this.gridSizeSubject.asObservable();\r\n  theme$: Observable<'light' | 'dark'> = this.themeSubject.asObservable();\r\n\r\n  constructor() {\r\n    this.setupBroadcast();\r\n    this.applyTheme(this.themeSubject.value);\r\n  }\r\n\r\n  get elements(): DrawingElement[] {\r\n    return this.elementsSubject.value;\r\n  }\r\n\r\n  get zoom(): number {\r\n    return this.zoomSubject.value;\r\n  }\r\n\r\n  get pan(): Point {\r\n    return this.panSubject.value;\r\n  }\r\n\r\n  get snapToGrid(): boolean {\r\n    return this.snapToGridSubject.value;\r\n  }\r\n\r\n  get gridSize(): number {\r\n    return this.gridSizeSubject.value;\r\n  }\r\n\r\n  get theme(): 'light' | 'dark' {\r\n    return this.themeSubject.value;\r\n  }\r\n\r\n  addElement(element: DrawingElement): void {\r\n    const zIndex = element.zIndex ?? (this.elements.length ? Math.max(...this.elements.map(e => e.zIndex ?? 0)) + 1 : 0);\r\n    const elements = [...this.elements, { ...element, zIndex }];\r\n    this.elementsSubject.next(elements);\r\n  }\r\n\r\n  updateElement(id: string, updates: Partial<DrawingElement>): void {\r\n    const elements = this.elements.map(el =>\r\n      el.id === id ? { ...el, ...updates } : el\r\n    );\r\n    this.elementsSubject.next(elements);\r\n  }\r\n\r\n  setElements(elements: DrawingElement[]): void {\r\n    this.elementsSubject.next(elements);\r\n  }\r\n\r\n  deleteElement(id: string): void {\r\n    const elements = this.elements.filter(el => el.id !== id);\r\n    this.elementsSubject.next(elements);\r\n  }\r\n\r\n  deleteSelectedElements(): void {\r\n    const elements = this.elements.filter(el => !el.isSelected);\r\n    this.elementsSubject.next(elements);\r\n    this.normalizeZIndices();\r\n  }\r\n\r\n  clearSelection(): void {\r\n    const elements = this.elements.map(el => ({ ...el, isSelected: false }));\r\n    this.elementsSubject.next(elements);\r\n  }\r\n\r\n  selectElement(id: string, addToSelection = false): void {\r\n    const elements = this.elements.map(el => ({\r\n      ...el,\r\n      isSelected: el.id === id ? true : (addToSelection ? el.isSelected : false)\r\n    }));\r\n    this.elementsSubject.next(elements);\r\n  }\r\n\r\n  setZoom(zoom: number): void {\r\n    this.zoomSubject.next(Math.max(0.1, Math.min(5, zoom)));\r\n  }\r\n\r\n  setPan(pan: Point): void {\r\n    this.panSubject.next(pan);\r\n  }\r\n\r\n  setSnapToGrid(enabled: boolean): void {\r\n    this.snapToGridSubject.next(enabled);\r\n  }\r\n\r\n  setGridSize(size: number): void {\r\n    const clamped = Math.max(5, Math.min(200, size));\r\n    this.gridSizeSubject.next(clamped);\r\n  }\r\n\r\n  rotateSelected(deltaDeg: number): void {\r\n    const elements = this.elements.map(el =>\r\n      el.isSelected ? { ...el, rotation: (el.rotation + deltaDeg) % 360 } : el\r\n    );\r\n    this.elementsSubject.next(elements);\r\n  }\r\n\r\n  alignSelected(alignment: 'left' | 'right' | 'top' | 'bottom' | 'center' | 'middle'): void {\r\n    const selected = this.elements.filter(el => el.isSelected);\r\n    if (selected.length < 2) return;\r\n\r\n    const bounds = this.getBounds(selected);\r\n    const updated = this.elements.map(el => {\r\n      if (!el.isSelected) return el;\r\n      const w = el.width || 0;\r\n      const h = el.height || 0;\r\n      switch (alignment) {\r\n        case 'left':\r\n          return { ...el, x: bounds.minX };\r\n        case 'right':\r\n          return { ...el, x: bounds.maxX - w };\r\n        case 'top':\r\n          return { ...el, y: bounds.minY };\r\n        case 'bottom':\r\n          return { ...el, y: bounds.maxY - h };\r\n        case 'center':\r\n          return { ...el, x: bounds.minX + (bounds.width - w) / 2 };\r\n        case 'middle':\r\n          return { ...el, y: bounds.minY + (bounds.height - h) / 2 };\r\n      }\r\n    });\r\n\r\n    this.elementsSubject.next(updated);\r\n  }\r\n\r\n  distributeSelected(orientation: 'horizontal' | 'vertical'): void {\r\n    const selected = this.elements\r\n      .filter(el => el.isSelected)\r\n      .sort((a, b) => (orientation === 'horizontal' ? a.x - b.x : a.y - b.y));\r\n    if (selected.length < 3) return;\r\n\r\n    const bounds = this.getBounds(selected);\r\n    const gaps = selected.length - 1;\r\n    if (orientation === 'horizontal') {\r\n      const totalWidth = selected.reduce((sum, el) => sum + Math.abs(el.width || 0), 0);\r\n      const space = bounds.width - totalWidth;\r\n      let cursor = bounds.minX;\r\n      const updatedIds = new Set(selected.map(s => s.id));\r\n      const updated = this.elements.map(el => {\r\n        if (!updatedIds.has(el.id)) return el;\r\n        const w = Math.abs(el.width || 0);\r\n        const next = { ...el, x: cursor };\r\n        cursor += w + space / gaps;\r\n        return next;\r\n      });\r\n      this.elementsSubject.next(updated);\r\n    } else {\r\n      const totalHeight = selected.reduce((sum, el) => sum + Math.abs(el.height || 0), 0);\r\n      const space = bounds.height - totalHeight;\r\n      let cursor = bounds.minY;\r\n      const updatedIds = new Set(selected.map(s => s.id));\r\n      const updated = this.elements.map(el => {\r\n        if (!updatedIds.has(el.id)) return el;\r\n        const h = Math.abs(el.height || 0);\r\n        const next = { ...el, y: cursor };\r\n        cursor += h + space / gaps;\r\n        return next;\r\n      });\r\n      this.elementsSubject.next(updated);\r\n    }\r\n  }\r\n\r\n  groupSelected(): void {\r\n    const selected = this.elements.filter(el => el.isSelected);\r\n    if (selected.length < 2) return;\r\n    const groupId = `group-${Date.now()}-${Math.random().toString(36).slice(2)}`;\r\n    const elements = this.elements.map(el => (el.isSelected ? { ...el, groupId } : el));\r\n    this.elementsSubject.next(elements);\r\n  }\r\n\r\n  ungroupSelected(): void {\r\n    const elements = this.elements.map(el => (el.isSelected ? { ...el, groupId: undefined } : el));\r\n    this.elementsSubject.next(elements);\r\n  }\r\n\r\n  bringToFront(): void {\r\n    const selectedIds = new Set(this.elements.filter(el => el.isSelected).map(el => el.id));\r\n    if (!selectedIds.size) return;\r\n    const reordered = [...this.elements]\r\n      .sort((a, b) => (a.zIndex ?? 0) - (b.zIndex ?? 0))\r\n      .map((el, idx) => ({ ...el, zIndex: idx }));\r\n\r\n    const max = reordered.length - 1;\r\n    const bumped = reordered.map(el => (selectedIds.has(el.id) ? { ...el, zIndex: max + 1 } : el));\r\n    this.elementsSubject.next(this.sortByZIndex(bumped));\r\n    this.normalizeZIndices();\r\n  }\r\n\r\n  sendToBack(): void {\r\n    const selectedIds = new Set(this.elements.filter(el => el.isSelected).map(el => el.id));\r\n    if (!selectedIds.size) return;\r\n    const reordered = [...this.elements]\r\n      .sort((a, b) => (a.zIndex ?? 0) - (b.zIndex ?? 0))\r\n      .map((el, idx) => ({ ...el, zIndex: idx }));\r\n\r\n    const bumped = reordered.map(el => (selectedIds.has(el.id) ? { ...el, zIndex: -1 } : el));\r\n    this.elementsSubject.next(this.sortByZIndex(bumped));\r\n    this.normalizeZIndices();\r\n  }\r\n\r\n  insertTemplate(name: 'sticky-notes' | 'flow'): void {\r\n    const baseX = 50;\r\n    const baseY = 80;\r\n    const palette = ['#FFEB3B', '#FFCDD2', '#C5E1A5', '#BBDEFB'];\r\n    let elements: DrawingElement[] = [];\r\n\r\n    if (name === 'sticky-notes') {\r\n      elements = palette.map((color, idx) => ({\r\n        id: this.generateId(),\r\n        type: 'rectangle',\r\n        x: baseX + idx * 140,\r\n        y: baseY,\r\n        width: 120,\r\n        height: 120,\r\n        strokeColor: '#444',\r\n        fillColor: color,\r\n        strokeWidth: 2,\r\n        rotation: 0,\r\n        text: 'Nota'\r\n      }));\r\n    } else {\r\n      elements = [\r\n        {\r\n          id: this.generateId(),\r\n          type: 'rectangle',\r\n          x: baseX,\r\n          y: baseY,\r\n          width: 160,\r\n          height: 90,\r\n          strokeColor: '#1976d2',\r\n          fillColor: '#E3F2FD',\r\n          strokeWidth: 2,\r\n          rotation: 0,\r\n          text: 'Início'\r\n        },\r\n        {\r\n          id: this.generateId(),\r\n          type: 'ellipse',\r\n          x: baseX + 220,\r\n          y: baseY,\r\n          width: 140,\r\n          height: 90,\r\n          strokeColor: '#388e3c',\r\n          fillColor: '#E8F5E9',\r\n          strokeWidth: 2,\r\n          rotation: 0,\r\n          text: 'Decisão'\r\n        },\r\n        {\r\n          id: this.generateId(),\r\n          type: 'arrow',\r\n          x: baseX + 160,\r\n          y: baseY + 45,\r\n          width: 60,\r\n          height: 0,\r\n          strokeColor: '#444',\r\n          fillColor: '#444',\r\n          strokeWidth: 3,\r\n          rotation: 0\r\n        }\r\n      ];\r\n    }\r\n\r\n    const currentMaxZ = this.elements.length ? Math.max(...this.elements.map(el => el.zIndex ?? 0)) : 0;\r\n    const withZ = elements.map((el, idx) => ({ ...el, zIndex: currentMaxZ + idx + 1 }));\r\n    this.elementsSubject.next([...this.elements, ...withZ]);\r\n  }\r\n\r\n  setTheme(theme: 'light' | 'dark'): void {\r\n    this.themeSubject.next(theme);\r\n    this.applyTheme(theme);\r\n  }\r\n\r\n  clear(): void {\r\n    this.elementsSubject.next([]);\r\n    this.zoomSubject.next(1);\r\n    this.panSubject.next({ x: 0, y: 0 });\r\n    this.snapToGridSubject.next(false);\r\n    this.gridSizeSubject.next(20);\r\n    this.themeSubject.next('light');\r\n  }\r\n\r\n  getState(): CanvasState {\r\n    return {\r\n      elements: [...this.elements],\r\n      zoom: this.zoom,\r\n      panX: this.pan.x,\r\n      panY: this.pan.y,\r\n      snapToGrid: this.snapToGrid,\r\n      gridSize: this.gridSize\r\n    };\r\n  }\r\n\r\n  setState(state: CanvasState): void {\r\n    this.elementsSubject.next([...state.elements]);\r\n    this.zoomSubject.next(state.zoom);\r\n    this.panSubject.next({ x: state.panX, y: state.panY });\r\n    this.snapToGridSubject.next(!!state.snapToGrid);\r\n    this.gridSizeSubject.next(state.gridSize ?? 20);\r\n  }\r\n\r\n  exportToJSON(): string {\r\n    return JSON.stringify(this.getState(), null, 2);\r\n  }\r\n\r\n  importFromJSON(json: string): boolean {\r\n    try {\r\n      const state = JSON.parse(json);\r\n      this.setState(state);\r\n      return true;\r\n    } catch {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  generateId(): string {\r\n    return `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\r\n  }\r\n\r\n  private getBounds(elements: DrawingElement[]) {\r\n    const xs = elements.map(el => [el.x, el.x + (el.width || 0)]).flat();\r\n    const ys = elements.map(el => [el.y, el.y + (el.height || 0)]).flat();\r\n    const minX = Math.min(...xs);\r\n    const maxX = Math.max(...xs);\r\n    const minY = Math.min(...ys);\r\n    const maxY = Math.max(...ys);\r\n    return { minX, maxX, minY, maxY, width: maxX - minX, height: maxY - minY };\r\n  }\r\n\r\n  private normalizeZIndices(): void {\r\n    const sorted = this.sortByZIndex(this.elements);\r\n    const normalized = sorted.map((el, idx) => ({ ...el, zIndex: idx }));\r\n    this.elementsSubject.next(normalized);\r\n  }\r\n\r\n  private sortByZIndex(elements: DrawingElement[]): DrawingElement[] {\r\n    return [...elements].sort((a, b) => (a.zIndex ?? 0) - (b.zIndex ?? 0));\r\n  }\r\n\r\n  private applyTheme(theme: 'light' | 'dark'): void {\r\n    const body = document.body;\r\n    body.classList.remove('theme-light', 'theme-dark');\r\n    body.classList.add(`theme-${theme}`);\r\n  }\r\n\r\n  private setupBroadcast(): void {\r\n    if (typeof BroadcastChannel === 'undefined') return;\r\n    this.broadcastChannel = new BroadcastChannel('whiteboard-sync');\r\n\r\n    this.broadcastChannel.onmessage = (event: MessageEvent) => {\r\n      const { origin, state } = event.data || {};\r\n      if (!state || origin === this.instanceId) return;\r\n      this.isApplyingRemote = true;\r\n      this.setState(state);\r\n      this.isApplyingRemote = false;\r\n    };\r\n\r\n    combineLatest([this.elements$, this.zoom$, this.pan$, this.snapToGrid$, this.gridSize$]).subscribe(([elements, zoom, pan, snap, grid]) => {\r\n      if (!this.broadcastChannel || this.isApplyingRemote) return;\r\n      const state: CanvasState = { elements, zoom, panX: pan.x, panY: pan.y, snapToGrid: snap, gridSize: grid };\r\n      this.broadcastChannel.postMessage({ origin: this.instanceId, state });\r\n    });\r\n  }\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}